<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MySQL高级教程 | MxRanger's Blog</title><meta name="keywords" content="mysql"><meta name="author" content="慕·歌"><meta name="copyright" content="慕·歌"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="b站视频内容总结详见视频    1、mysql架构介绍1、目录结构 windows默认安装下    路径 解释    C:\ProgramData\MySQL\MySQL Server 5.7\Data mysql数据库文件存放路径   C:\Program Files\MySQL\MySQL Server 5.7\bin 相关命令目录">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL高级教程">
<meta property="og:url" content="http://example.com/2019/12/12/back/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/index.html">
<meta property="og:site_name" content="MxRanger&#39;s Blog">
<meta property="og:description" content="b站视频内容总结详见视频    1、mysql架构介绍1、目录结构 windows默认安装下    路径 解释    C:\ProgramData\MySQL\MySQL Server 5.7\Data mysql数据库文件存放路径   C:\Program Files\MySQL\MySQL Server 5.7\bin 相关命令目录">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/mysql%E9%AB%98%E7%BA%A7.jpg">
<meta property="article:published_time" content="2019-12-12T03:01:16.000Z">
<meta property="article:modified_time" content="2021-06-19T02:55:13.496Z">
<meta property="article:author" content="慕·歌">
<meta property="article:tag" content="mysql">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/mysql%E9%AB%98%E7%BA%A7.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2019/12/12/back/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL高级教程',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-06-19 10:55:13'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><style type="text/css">#toggle-sidebar {bottom: 80px}</style><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="MxRanger's Blog" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/images/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">55</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">27</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">27</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/book"><i class="fa-fw fa fa-book"></i><span> 书籍</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/mysql%E9%AB%98%E7%BA%A7.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">MxRanger's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/book"><i class="fa-fw fa fa-book"></i><span> 书籍</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MySQL高级教程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2019-12-12T03:01:16.000Z" title="发表于 2019-12-12 11:01:16">2019-12-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-06-19T02:55:13.496Z" title="更新于 2021-06-19 10:55:13">2021-06-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/mysql/">mysql</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">9.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>38分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MySQL高级教程"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><div class="note info flat"><p>b站视频内容总结<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av49181542">详见视频</a></p>
</div>


<h1 id="1、mysql架构介绍"><a href="#1、mysql架构介绍" class="headerlink" title="1、mysql架构介绍"></a>1、mysql架构介绍</h1><h2 id="1、目录结构"><a href="#1、目录结构" class="headerlink" title="1、目录结构"></a>1、目录结构</h2><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562313619304.png" alt="1562313619304"></p>
<p>windows默认安装下</p>
<table>
<thead>
<tr>
<th>路径</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>C:\ProgramData\MySQL\MySQL Server 5.7\Data</td>
<td>mysql数据库文件存放路径</td>
</tr>
<tr>
<td>C:\Program Files\MySQL\MySQL Server 5.7\bin</td>
<td>相关命令目录</td>
</tr>
</tbody></table>
<span id="more"></span>

<h2 id="2、配置文件"><a href="#2、配置文件" class="headerlink" title="2、配置文件"></a>2、配置文件</h2><table>
<thead>
<tr>
<th>系统</th>
<th>路径</th>
</tr>
</thead>
<tbody><tr>
<td>windows</td>
<td>C:\ProgramData\MySQL\MySQL Server 5.7\my.ini</td>
</tr>
<tr>
<td>linux</td>
<td>/etc/my.cnf</td>
</tr>
</tbody></table>
<p>主要配置文件</p>
<table>
<thead>
<tr>
<th>配置文件信息</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>二进制日志log-bin</td>
<td>主从复制</td>
</tr>
<tr>
<td>错误日志log-error</td>
<td>默认关闭，记录严重的警告和错误信息，每次启动和关闭的详细信息等</td>
</tr>
<tr>
<td>查询日志log</td>
<td>默认关闭，记录查询的sql语句，如果开启会降低mysql整体性能，消耗资源</td>
</tr>
<tr>
<td>数据文件</td>
<td>[数据文件](# 3、数据文件)</td>
</tr>
</tbody></table>
<h2 id="3、数据文件"><a href="#3、数据文件" class="headerlink" title="3、数据文件"></a>3、数据文件</h2><h3 id="采用MyISAM"><a href="#采用MyISAM" class="headerlink" title="采用MyISAM"></a>采用MyISAM</h3><p>创建表后会有相应的文件</p>
<table>
<thead>
<tr>
<th>文件类型</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>frm</td>
<td>存放表结构</td>
</tr>
<tr>
<td>myd</td>
<td>存放表数据</td>
</tr>
<tr>
<td>myi</td>
<td>存放表索引</td>
</tr>
</tbody></table>
<h3 id="采用InnoDB"><a href="#采用InnoDB" class="headerlink" title="采用InnoDB"></a>采用InnoDB</h3><table>
<thead>
<tr>
<th>文件类型</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>frm</td>
<td>存放表结构</td>
</tr>
<tr>
<td>ibd</td>
<td>存放表数据和索引信息</td>
</tr>
<tr>
<td>myi</td>
<td>分区存储</td>
</tr>
</tbody></table>
<h2 id="4、逻辑架构"><a href="#4、逻辑架构" class="headerlink" title="4、逻辑架构"></a>4、逻辑架构</h2><p>连接层、 服务层、引擎层、存储层</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562465089529.png" alt="1562465089529"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562547594658.png" alt="1562547594658"></p>
<h2 id="5、存储引擎"><a href="#5、存储引擎" class="headerlink" title="5、存储引擎"></a>5、存储引擎</h2><h3 id="1、查看命令"><a href="#1、查看命令" class="headerlink" title="1、查看命令"></a>1、查看命令</h3><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562468067667.png" alt="1562468067667"></p>
<h3 id="2、两种存储引擎的对比"><a href="#2、两种存储引擎的对比" class="headerlink" title="2、两种存储引擎的对比"></a>2、两种存储引擎的对比</h3><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562468301820.png" alt="1562468301820"></p>
<h3 id="3、阿里巴巴、淘宝用哪个"><a href="#3、阿里巴巴、淘宝用哪个" class="headerlink" title="3、阿里巴巴、淘宝用哪个"></a>3、阿里巴巴、淘宝用哪个</h3><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562468462939.png" alt="1562468462939"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562468505117.png" alt="1562468505117"></p>
<h1 id="2、索引优化分析"><a href="#2、索引优化分析" class="headerlink" title="2、索引优化分析"></a>2、索引优化分析</h1><h2 id="1、性能下降"><a href="#1、性能下降" class="headerlink" title="1、性能下降"></a>1、性能下降</h2><p>[1] 查询语句写的烂</p>
<p>[2] 索引失效（单值、复合）</p>
<p>单值索引：</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562482326220.png" alt="1562482326220"></p>
<p>复合索引：</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562482346108.png" alt="1562482346108"></p>
<p>[3] 关联查询太多join</p>
<p>[4] 服务器调优及各个参数设置（缓冲、线程数）</p>
<h2 id="2、常见通用的join查询"><a href="#2、常见通用的join查询" class="headerlink" title="2、常见通用的join查询"></a>2、常见通用的join查询</h2><h3 id="1、sql执行顺序"><a href="#1、sql执行顺序" class="headerlink" title="1、sql执行顺序"></a>1、sql执行顺序</h3><p>手写顺序</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562482436989.png" alt="1562482436989"></p>
<p>机读顺序</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562482264884.png" alt="1562482264884"></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562482505700.png" alt="1562482505700"></p>
<h3 id="2、7种join"><a href="#2、7种join" class="headerlink" title="2、7种join"></a>2、7种join</h3><h4 id="图解"><a href="#图解" class="headerlink" title="图解"></a>图解</h4><p><img src="/images/MySQL%E5%9F%BA%E7%A1%80%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1560566711450.png" alt="1560566711450"></p>
<p><img src="/images/MySQL%E5%9F%BA%E7%A1%80%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1560566734011.png" alt="1560566734011"></p>
<h4 id="编写"><a href="#编写" class="headerlink" title="编写"></a>编写</h4><h5 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">create datebase db0629;</span><br><span class="line"></span><br><span class="line">create table tbl_dept(</span><br><span class="line">	id INT(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">	deptName VARCHAR(30) DEFAULT null,</span><br><span class="line">	locAdd VARCHAR(40) DEFAULT null,</span><br><span class="line">	PRIMARY KEY(id)</span><br><span class="line">)ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">create table tbl_emp(</span><br><span class="line">	id INT(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">	name VARCHAR(20) DEFAULT null,</span><br><span class="line">	deptId INT(41) DEFAULT null,</span><br><span class="line">	PRIMARY KEY(id),</span><br><span class="line">	KEY fk_dept_id(deptId)</span><br><span class="line">)ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">insert into tbl_dept(deptName,locAdd) VALUES(&#x27;RD&#x27;,11);</span><br><span class="line">insert into tbl_dept(deptName,locAdd) VALUES(&#x27;HR&#x27;,12);</span><br><span class="line">insert into tbl_dept(deptName,locAdd) VALUES(&#x27;MK&#x27;,13);</span><br><span class="line">insert into tbl_dept(deptName,locAdd) VALUES(&#x27;MIS&#x27;,14);</span><br><span class="line">insert into tbl_dept(deptName,locAdd) VALUES(&#x27;FD&#x27;,15);</span><br><span class="line"></span><br><span class="line">insert into tbl_emp(name,deptId) VALUES(&#x27;z3&#x27;,1);</span><br><span class="line">insert into tbl_emp(name,deptId) VALUES(&#x27;z4&#x27;,1);</span><br><span class="line">insert into tbl_emp(name,deptId) VALUES(&#x27;z5&#x27;,1);</span><br><span class="line">insert into tbl_emp(name,deptId) VALUES(&#x27;w5&#x27;,2);</span><br><span class="line">insert into tbl_emp(name,deptId) VALUES(&#x27;w6&#x27;,2);</span><br></pre></td></tr></table></figure>



<h5 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h5><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562551995856.png" alt="1562551995856"></p>
<h5 id="左连接"><a href="#左连接" class="headerlink" title="左连接"></a>左连接</h5><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562552028273.png" alt="1562552028273"></p>
<h5 id="右连接"><a href="#右连接" class="headerlink" title="右连接"></a>右连接</h5><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562552050783.png" alt="1562552050783"></p>
<h5 id="左连接——A独有"><a href="#左连接——A独有" class="headerlink" title="左连接——A独有"></a>左连接——A独有</h5><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562552241017.png" alt="1562552241017"></p>
<h5 id="右连接——B独有"><a href="#右连接——B独有" class="headerlink" title="右连接——B独有"></a>右连接——B独有</h5><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562552415831.png" alt="1562552415831"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562552394162.png" alt="1562552394162"></p>
<h5 id="全连接"><a href="#全连接" class="headerlink" title="全连接"></a>全连接</h5><p>oracle支持、mysql不支持</p>
<p>那如何查询量表独有的数据，且能查询量表共有数据不重复，等同于全连接？</p>
<p>使用union联合查询<em><strong>（两表记录拼接）</strong></em>可以达到全连接的效果</p>
<p><strong>a,b表的共有 + a表独有 + b表独有</strong></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562553332405.png" alt="1562553332405"></p>
<p><strong>a，b表的独有</strong></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562553564573.png" alt="1562553564573"></p>
<h2 id="3、索引"><a href="#3、索引" class="headerlink" title="3、索引"></a>3、索引</h2><h3 id="1、介绍"><a href="#1、介绍" class="headerlink" title="1、介绍"></a>1、介绍</h3><p>索引是帮助MySQL高效获取数据的数据结构</p>
<p><strong>本质：索引是一种数据结构</strong>     <strong>目的：提高查找效率</strong></p>
<p><span style="color:red">简单理解：排好序的快速查找数据结构</span></p>
<h4 id="详解"><a href="#详解" class="headerlink" title="详解"></a>详解</h4><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562655186449.png" alt="1562655186449"></p>
<h4 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h4><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562675915837.png" alt="1562675915837"></p>
<p>一般来说索引本身也很大，不可能全部存储在内存中，因此索引往往以索引文件的形式存储在磁盘上</p>
<p><span style="color:red">我们平常所说的索引，如果没有特别指明，都是指B树（多路搜索树，并不一定是二叉的）结构阻止的索引。</span>其中聚集索引、次要索引、覆盖索引、复合索引、前缀索引，唯一索引默认都是使用B+数索引，统称索引。当然，除了B+数这种类型的索引之外，还有哈希索引（hash index）等</p>
<h3 id="2、优点"><a href="#2、优点" class="headerlink" title="2、优点"></a>2、优点</h3><p>【1】类似大学图书馆建数目索引，提高数据检索的效率，降低数据库的IO成本</p>
<p>【2】通过索引列队数据进行排序，降低数据排序的成本，降低CPU消耗</p>
<h3 id="3、缺点"><a href="#3、缺点" class="headerlink" title="3、缺点"></a>3、缺点</h3><p>【1】实际上索引也是一张表，该表保存了主键与索引字段，并指向实体表的记录，索引索引列也是要占用空间的</p>
<p>【2】虽然索引大大提高查询速度，同时却会降低更新表的速度，如对表进行insert、update和delete，因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件每次更新添加了索引列的字段，都会调整因为更新所带来的键值变化后索引信息</p>
<p>【3】索引只是提高效率的一个因素，如果你的MySQL有大数据量的表，就需要花时间研究建立最优秀的索引，或优化查询语句</p>
<h3 id="5、分类"><a href="#5、分类" class="headerlink" title="5、分类"></a>5、分类</h3><h4 id="单值索引"><a href="#单值索引" class="headerlink" title="单值索引"></a>单值索引</h4><p>即一个索引只包含单个列，一个表可以有多个单例索引</p>
<h4 id="唯一索引"><a href="#唯一索引" class="headerlink" title="唯一索引"></a>唯一索引</h4><p>索引列的值必须唯一，但允许有空值</p>
<h4 id="复合索引"><a href="#复合索引" class="headerlink" title="复合索引"></a>复合索引</h4><p>即一个索引包含多个列</p>
<p>基本语法</p>
<h4 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create [unique] index indexName on mytable(columname(length))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter mytable add [unique] index [indexName] on (columnname(length))</span><br></pre></td></tr></table></figure>

<h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop index [indexName] on mytable</span><br></pre></td></tr></table></figure>

<h4 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show index from table_name</span><br></pre></td></tr></table></figure>

<h4 id="使用alter命令"><a href="#使用alter命令" class="headerlink" title="使用alter命令"></a>使用alter命令</h4><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562725302031.png" alt="1562725302031"></p>
<h3 id="6、索引结构"><a href="#6、索引结构" class="headerlink" title="6、索引结构"></a>6、索引结构</h3><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562725375115.png" alt="1562725375115"></p>
<p>常用的就是b树索引</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562726908900.png" alt="1562726908900"></p>
<h4 id="BTree索引（★★★）"><a href="#BTree索引（★★★）" class="headerlink" title="BTree索引（★★★）"></a>BTree索引（★★★）</h4><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562725618351.png" alt="1562725618351"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562725764061.png" alt="1562725764061"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562726567948.png" alt="1562726567948"></p>
<h3 id="7、使用情况"><a href="#7、使用情况" class="headerlink" title="7、使用情况"></a>7、使用情况</h3><h4 id="需要创建索引情况"><a href="#需要创建索引情况" class="headerlink" title="需要创建索引情况"></a>需要创建索引情况</h4><p>[1] 主键自动建立唯一索引</p>
<p>[2] 频繁作为查询条件的字段应该创建索引</p>
<p>[3] 查询中与其他表关联的字段，外键关系建立索引</p>
<p>[4] 频繁更新的字段不适合创建索引</p>
<p><em><strong>原因：因为每次更新不单单是更新了记录还会更新索引</strong></em></p>
<p>[5] where条件里用不到的字段不创建索引</p>
<p>[6] 单键/组合索引的选择问题  （高并发下倾向创建组合索引）</p>
<p>[7] 查询中排序的字段，排序字段若通过索引去访问将大大提高排序速度</p>
<p>[8] 查询中统计或分组字段</p>
<h4 id="不需要创建索引情况"><a href="#不需要创建索引情况" class="headerlink" title="不需要创建索引情况"></a>不需要创建索引情况</h4><p>[1]表记录太少（三百万以上）</p>
<p>[2]经常增删改的表</p>
<p><em><strong>原因：提高查询速度，同时却会降低更新表的速度，如对表进行insert、update、delete。因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件</strong></em></p>
<p>[3] 数据重复且分布均匀的表字段，因此应该只为经常查询和最经常排序的数据列建立索引。注意：如果每个数据列包含许多重复的内容，为它建立索引就没有太大的实际效果。</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562727970377.png" alt="1562727970377"></p>
<h2 id="4、性能分析"><a href="#4、性能分析" class="headerlink" title="4、性能分析"></a>4、性能分析</h2><h3 id="1、MySQL-Query-Optimizer"><a href="#1、MySQL-Query-Optimizer" class="headerlink" title="1、MySQL Query Optimizer"></a>1、MySQL Query Optimizer</h3><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562828303386.png" alt="1562828303386"></p>
<h3 id="2、MySQL常见瓶颈"><a href="#2、MySQL常见瓶颈" class="headerlink" title="2、MySQL常见瓶颈"></a>2、MySQL常见瓶颈</h3><p>CPU：CPU在饱和的时候一般发生在数据装入内存或磁盘上读取数据时候</p>
<p>IO：磁盘I/O瓶颈发生在装入数据远大于内存容量的时候</p>
<p>服务器应届的性能瓶颈：top、free、iostat和vmstat来查看系统的性能状态</p>
<h3 id="3、EXPLAIN关键字"><a href="#3、EXPLAIN关键字" class="headerlink" title="3、EXPLAIN关键字"></a>3、EXPLAIN关键字</h3><h4 id="1、介绍-1"><a href="#1、介绍-1" class="headerlink" title="1、介绍"></a>1、介绍</h4><p>使用explain 关键字可以模拟优化器质性SQL查询语句，从而知道MySQL是如何处理你的SQL语句的。分析你的查询语句或是表结构的性能瓶颈</p>
<p>两种方式查看信息</p>
<p>explain + sql语句      （横版）       或者        explain + sql语句 + \G   （竖版）</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563067896613.png" alt="1563067896613"></p>
<h4 id="2、用途"><a href="#2、用途" class="headerlink" title="2、用途"></a>2、用途</h4><p>[1] 表的读取顺序 (id)</p>
<p>[2] 数据读取操作的操作类型 (select_type)</p>
<p>[3] 哪些索引可以使用（possible_keys）</p>
<p>[4] 哪些索引被实际使用 (key)</p>
<p>[5] 表之间的引用 (ref)</p>
<p>[6] 每张表有多少行被优化器查询 (rows)</p>
<h4 id="3、各字段解释"><a href="#3、各字段解释" class="headerlink" title="3、各字段解释"></a>3、各字段解释</h4><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562832868456.png" alt="1562832868456"></p>
<h5 id="1、id-★★★"><a href="#1、id-★★★" class="headerlink" title="1、id(★★★)"></a>1、id(★★★)</h5><h6 id="1、id相同"><a href="#1、id相同" class="headerlink" title="1、id相同"></a>1、id相同</h6><p><em><strong>结论：id相同，执行顺序由上至下</strong></em></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562833260375.png" alt="1562833260375"></p>
<h6 id="2、id不同"><a href="#2、id不同" class="headerlink" title="2、id不同"></a>2、id不同</h6><p>id值越大，优先级越高，越先被执行</p>
<p><em><strong>结论：最里面先执行，执行完再执行外面</strong></em></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562834820380.png" alt="1562834820380"></p>
<h6 id="3、id相同-不同"><a href="#3、id相同-不同" class="headerlink" title="3、id相同+不同"></a>3、id相同+不同</h6><p><em><strong>结论：id不同，先执行id值高的；id相同，再按顺序执行</strong></em></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562835041054.png" alt="1562835041054"></p>
<h5 id="2、select-type"><a href="#2、select-type" class="headerlink" title="2、select_type"></a>2、select_type</h5><p>主要区别于普通查询、联合查询、子查询等的复杂查询</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562895858960.png" alt="1562895858960"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562895997142.png" alt="1562895997142"></p>
<h5 id="3、table"><a href="#3、table" class="headerlink" title="3、table"></a>3、table</h5><p>显示着一行的数据是关于哪张表</p>
<h5 id="4、type-★★★"><a href="#4、type-★★★" class="headerlink" title="4、type(★★★)"></a>4、type(★★★)</h5><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562896400411.png" alt="1562896400411"></p>
<p><span style="color:red"><strong>从最好到最差依次为：system&gt;const&gt;eq_ref&gt;ref&gt;range&gt;index&gt;ALL</strong></span></p>
<p>一般来说，得保证查询至少达到range级别，最好能达到ref</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562897176702.png" alt="1562897176702"></p>
<h6 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h6><p><em><strong>【 system、const 】</strong></em></p>
<p>单行单表查询速度最快</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562897990578.png" alt="1562897990578"></p>
<p><em><strong>【 eq_ref 】</strong></em></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562899162056.png" alt="1562899162056"></p>
<p><em><strong>【ref】</strong></em></p>
<p>非唯一索引扫描</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562899509488.png" alt="1562899509488"></p>
<p><em><strong>【range】</strong></em></p>
<p>范围查询比全表查询好一些</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562900172447.png" alt="1562900172447"></p>
<p><em><strong>【index】</strong></em></p>
<p>id主键索引，前提是id建了索引</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562900373895.png" alt="1562900373895"></p>
<p><em><strong>【ALL】</strong></em></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562900487021.png" alt="1562900487021"></p>
<h5 id="5、possible-keys、key-★★★"><a href="#5、possible-keys、key-★★★" class="headerlink" title="5、possible_keys、key(★★★)"></a>5、possible_keys、key(★★★)</h5><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562981774596.png" alt="1562981774596"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562982024121.png" alt="1562982024121"></p>
<p><span style="color:red"><strong>总结：possible_keys 理论上用了几个索引，key实际上用了几个索引</strong></span></p>
<h6 id="举例1"><a href="#举例1" class="headerlink" title="举例1"></a>举例1</h6><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562982431561.png" alt="1562982431561"></p>
<p>理论上用primary和idx_t1两个索引，实际只用到idx_t1一个索引</p>
<h6 id="举例2"><a href="#举例2" class="headerlink" title="举例2"></a>举例2</h6><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562982549442.png" alt="1562982549442"></p>
<p>如果查询的字段刚好和你创建的索引一致的话，理论上没有索引，单实际上用了创建的索引，如上图<code>idx_col1_col2</code>索引，比<code>select *.....</code>来得快，因为type是index，而不是all</p>
<h5 id="6、key-len"><a href="#6、key-len" class="headerlink" title="6、key_len"></a>6、key_len</h5><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562982931136.png" alt="1562982931136"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562983569857.png" alt="1562983569857"></p>
<hr>
<p>【结论】：相同条件下查询，key_len越小越好，精度越小越好。精度高消耗大</p>
<h5 id="7、ref"><a href="#7、ref" class="headerlink" title="7、ref"></a>7、ref</h5><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562983818094.png" alt="1562983818094"></p>
<h6 id="举例1-1"><a href="#举例1-1" class="headerlink" title="举例1"></a>举例1</h6><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562984512712.png" alt="1562984512712"></p>
<p>t1先根据条件常量进行查询后，t1作为驱动表进行关联查询，ref中会显示test库中t1表里的id字段被使用</p>
<h6 id="举例2-1"><a href="#举例2-1" class="headerlink" title="举例2"></a>举例2</h6><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562984567264.png" alt="1562984567264"></p>
<p>t2作为驱动表进行全表扫描，然后根据连接条件，ref中显示t2表中使用的col1字段，以及<code>t1.col2=‘ac’</code>常量条件</p>
<hr>
<p>【总结】：如果是使用的常数等值查询，这里会显示const，如果是连接查询，被驱动表的执行计划这里会显示驱动表的关联字段，如果是条件使用了表达式或者函数，或者条件列发生了内部隐式转换，这里可能显示为func</p>
<h5 id="8、rows-★★★"><a href="#8、rows-★★★" class="headerlink" title="8、rows(★★★)"></a>8、rows(★★★)</h5><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562985248900.png" alt="1562985248900"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1562985581967.png" alt="1562985581967"></p>
<h5 id="9、extra-★★★"><a href="#9、extra-★★★" class="headerlink" title="9、extra(★★★)"></a>9、extra(★★★)</h5><p>包含不合适在其他列中显示但十分重要的额外信息</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/2019-07-14_092733.png" alt="2019-07-14_092733"></p>
<h6 id="1、Using-filesort-★★★"><a href="#1、Using-filesort-★★★" class="headerlink" title="1、Using filesort(★★★)"></a>1、Using filesort(★★★)</h6><p><span style="color:red"><em><strong>评价：性能很差</strong></em></span></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563067624976.png" alt="1563067624976"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/TIM%E6%88%AA%E5%9B%BE20190714094047.jpg" alt="TIM截图20190714094047"></p>
<hr>
<p>【结论】：后者效率高，性能更加，前者另起炉灶，虽有索引，但没用到，用的文件排序</p>
<h6 id="2、Using-temporary-★★★"><a href="#2、Using-temporary-★★★" class="headerlink" title="2、Using temporary(★★★)"></a>2、Using temporary(★★★)</h6><p><span style="color:red"><em><strong>评价：比Using filesort更差</strong></em></span></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/TIM%E6%88%AA%E5%9B%BE20190714095559.jpg" alt="TIM截图20190714095559"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/TIM%E6%88%AA%E5%9B%BE20190714144421.jpg" alt="TIM截图20190714144421"></p>
<h6 id="3、Using-index-★★★"><a href="#3、Using-index-★★★" class="headerlink" title="3、Using index(★★★)"></a>3、Using index(★★★)</h6><p><span style="color:red"><em><strong>评价：效率不错</strong></em></span></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/TIM%E6%88%AA%E5%9B%BE20190714144950.jpg" alt="TIM截图20190714144950"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563087112897.png" alt="1563087112897"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/TIM%E6%88%AA%E5%9B%BE20190714145552.jpg" alt="TIM截图20190714145552"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563087694241.png" alt="1563087694241"></p>
<h6 id="4、using-where"><a href="#4、using-where" class="headerlink" title="4、using where"></a>4、using where</h6><p>表明使用了where过滤</p>
<h6 id="5、using-join-buffer"><a href="#5、using-join-buffer" class="headerlink" title="5、using join buffer"></a>5、using join buffer</h6><p>使用连接缓存</p>
<h6 id="6、impossible-where"><a href="#6、impossible-where" class="headerlink" title="6、impossible where"></a>6、impossible where</h6><p>where子句的值总是false，不能用来获取任何元组</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563088478530.png" alt="1563088478530"></p>
<h6 id="7、select-tables-optimized-away"><a href="#7、select-tables-optimized-away" class="headerlink" title="7、select tables optimized away"></a>7、select tables optimized away</h6><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563088501273.png" alt="1563088501273"></p>
<h6 id="8、distinct"><a href="#8、distinct" class="headerlink" title="8、distinct"></a>8、distinct</h6><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563088527305.png" alt="1563088527305"></p>
<h3 id="4、热身案例"><a href="#4、热身案例" class="headerlink" title="4、热身案例"></a>4、热身案例</h3><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563089145085.png" alt="1563089145085"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563089331442.png" alt="1563089331442"></p>
<h2 id="5、索引优化"><a href="#5、索引优化" class="headerlink" title="5、索引优化"></a>5、索引优化</h2><h3 id="1、索引分析"><a href="#1、索引分析" class="headerlink" title="1、索引分析"></a>1、索引分析</h3><h4 id="1、单表"><a href="#1、单表" class="headerlink" title="1、单表"></a>1、单表</h4><h5 id="建立SQL"><a href="#建立SQL" class="headerlink" title="建立SQL"></a>建立SQL</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE article (</span><br><span class="line">id INT(10) UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT, </span><br><span class="line">author_id INT(10) UNSIGNED NOT NULL,</span><br><span class="line">category_id INT(10) UNSIGNED NOT NULL,</span><br><span class="line">views INT(10) UNSIGNED NOT NULL,</span><br><span class="line">comments INT(10) UNSIGNED NOT NULL, </span><br><span class="line">title VARBINARY(255) NOT NULL, </span><br><span class="line">content TEXT NOT NULL</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO article(author_id, category_id, views, comments, title, content) VALUES </span><br><span class="line">(1, 1,1,1, &#x27;1&#x27;,&#x27;1&#x27;),</span><br><span class="line">(2, 2, 2, 2,&#x27;2&#x27;,&#x27;2&#x27;),</span><br><span class="line">(1, 1,3, 3,&#x27;3&#x27;,&#x27;3&#x27;);</span><br></pre></td></tr></table></figure>



<h5 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h5><blockquote>
<p>查询category_id为1且comments大于1的情况下，views最多的article_id</p>
</blockquote>
<p><strong>步骤：</strong></p>
<p><strong>[1]首先 编写sql语句</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN</span><br><span class="line">SELECT id,author_id</span><br><span class="line">FROM article</span><br><span class="line">WHERE category_id = 1 AND comments &gt; 1</span><br><span class="line">ORDER BY views</span><br><span class="line">DESC LIMIT 1;</span><br></pre></td></tr></table></figure>

<p>查询结果</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563091204680.png" alt="1563091204680"></p>
<hr>
<p>结论，很显然，type是ALL，即最坏的情况，Extra里还出现了using filesort，也是最坏的情况，必须优化</p>
<p><strong>[2] 建立索引</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX idx_article_ccv on article(category_id,comments,views);</span><br><span class="line">#查看</span><br><span class="line">show index from article;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563091372030.png" alt="1563091372030"></p>
<p><strong>[3] explain分析</strong></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563091420110.png" alt="1563091420110"></p>
<hr>
<p>结果发现，type变成了range，可以忍受，但是Extra里还出现了using filesort是无法接受的</p>
<p><strong>继续优化！！！</strong></p>
<p><strong>【4】置换条件分析</strong></p>
<p>与 <code>comment = 1</code>条件进行比对</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563091537358.png" alt="1563091537358"></p>
<p>发现性能变好了，type变成ref，extra也没有using filesort</p>
<hr>
<p>得出结论：范围条件可能会导致索引失效，用不上后面的索引，就好比建了个三层楼，告诉你101、202、3楼挨个搜，用不上后面的索引了</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563091821021.png" alt="1563091821021"></p>
<p><strong>【5】重新建立索引</strong></p>
<p>鉴于上面的范围问题，<span style="color:red"><strong>采取绕过范围字段</strong></span>，将category_id和views建立索引</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#删除索引</span><br><span class="line">DROP INDEX idx_article_ccv on article;</span><br><span class="line">#重建索引</span><br><span class="line">CREATE INDEX idx_article_ccv on article(category_id,views);</span><br></pre></td></tr></table></figure>



<p><strong>【6】explain继续查看结果</strong></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563103971539.png" alt="1563103971539"></p>
<hr>
<p>可以看到，type变成ref，ectra中的using filesort也消失了，结果非常理想</p>
<h4 id="2、两表"><a href="#2、两表" class="headerlink" title="2、两表"></a>2、两表</h4><h5 id="建立SQL-1"><a href="#建立SQL-1" class="headerlink" title="建立SQL"></a>建立SQL</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS class(</span><br><span class="line">	id INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,</span><br><span class="line">	card INT(10) UNSIGNED NOT NULL,</span><br><span class="line">	PRIMARY KEY(id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE TABLE IF NOT EXISTS book(</span><br><span class="line">	bookid INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,</span><br><span class="line">	card INT(10) UNSIGNED NOT NULL,</span><br><span class="line">	PRIMARY KEY(bookid)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br></pre></td></tr></table></figure>







<h5 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h5><blockquote>
<p>左连接两表查询所有记录</p>
</blockquote>
<p><strong>步骤：</strong></p>
<p>【1】首先explain分析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#分析</span><br><span class="line">explain </span><br><span class="line">#左：class  右：book</span><br><span class="line">select * from class left join book on class.card = book.card;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563173355156.png" alt="1563173355156"></p>
<hr>
<p>结果很糟糕</p>
<p>【2】右表加索引</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#[1] 试试右表索引  </span><br><span class="line">ALTER TABLE book add INDEX Y(card);</span><br></pre></td></tr></table></figure>

<p>继续explain分析，结果如下</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563173439652.png" alt="1563173439652"></p>
<hr>
<p>结果发现一个all一个ref，总共rows 21行，不错</p>
<p>【3】试试左表加索引</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#删除</span><br><span class="line">drop index Y on book;</span><br><span class="line">#[2] 试试左表索引  </span><br><span class="line">ALTER TABLE class add INDEX Y(card);</span><br></pre></td></tr></table></figure>

<p>继续explain分析，结果如下</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563173520464.png" alt="1563173520464"></p>
<hr>
<p>结果发现，一个是index一个all，index的性能没有ref好，而且rows总共40行，还有extra出现连接缓存</p>
<p>【结论】：这是由左连接的特性决定的。</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563173986234.png" alt="1563173986234"></p>
<p><code>LEFT JOIN</code>条件用于确定如何从右表搜索行，左边一定都有，所以右边是我们的关键点，一定要建立索引。左边是需要全部扫描的，而右边部分扫描，用索引更好。</p>
<p><span style="color:red"><strong>★★★右连接同理，索引加载左表上！！！★★★</strong></span></p>
<h4 id="3、三表"><a href="#3、三表" class="headerlink" title="3、三表"></a>3、三表</h4><h5 id="建立SQL-2"><a href="#建立SQL-2" class="headerlink" title="建立SQL"></a>建立SQL</h5><p>在两表的基础上加一个phone表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS phone(</span><br><span class="line">	phoneid INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,</span><br><span class="line">	card INT(10) UNSIGNED NOT NULL,</span><br><span class="line">	PRIMARY KEY(phoneid)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br></pre></td></tr></table></figure>





<h5 id="案例-2"><a href="#案例-2" class="headerlink" title="案例"></a>案例</h5><blockquote>
<p>三表查询</p>
</blockquote>
<p><strong>步骤：</strong></p>
<p>【1】explain分析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#三表查询</span><br><span class="line">explain</span><br><span class="line">select * </span><br><span class="line">from class</span><br><span class="line">LEFT JOIN book</span><br><span class="line">on class.card = book.card</span><br><span class="line">LEFT JOIN phone</span><br><span class="line">on book.card = phone.card</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563175244554.png" alt="1563175244554"></p>
<hr>
<p>继续优化</p>
<p>【2】添加索引</p>
<p>在book和phone上添加索引</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE book ADD INDEX Y(card);</span><br><span class="line">ALTER TABLE phone ADD INDEX Y(card);</span><br></pre></td></tr></table></figure>

<p>继续explain分析</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563175355033.png" alt="1563175355033"></p>
<hr>
<p>效果很好</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563175407152.png" alt="1563175407152"></p>
<p>【结论】</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563175553954.png" alt="1563175553954"></p>
<h3 id="2、索引失效（应该避免）"><a href="#2、索引失效（应该避免）" class="headerlink" title="2、索引失效（应该避免）"></a>2、索引失效（应该避免）</h3><h4 id="索引失效10种原因"><a href="#索引失效10种原因" class="headerlink" title="索引失效10种原因"></a>索引失效10种原因</h4><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563239560954.png" alt="1563239560954"></p>
<h4 id="案例分析——索引优化No-1"><a href="#案例分析——索引优化No-1" class="headerlink" title="案例分析——索引优化No.1"></a>案例分析——索引优化No.1</h4><h5 id="建立sql"><a href="#建立sql" class="headerlink" title="建立sql"></a>建立sql</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">create table staffs(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	NAME VARCHAR(24) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;姓名&#x27;,</span><br><span class="line">	age INT NOT NULL DEFAULT 0 COMMENT &#x27;年龄&#x27;,</span><br><span class="line">	pos VARCHAR(20) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;职位&#x27;, </span><br><span class="line">  add_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;入职时间&#x27;</span><br><span class="line">)CHARSET UTF8 COMMENT &#x27;员工记录表&#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO staffs(NAME,age,pos,add_time) VALUES(&#x27;Z3&#x27;,22,&#x27;MANAGER&#x27;,NOW());</span><br><span class="line">INSERT INTO staffs(NAME,age,pos,add_time) VALUES(&#x27;july&#x27;,23,&#x27;dev&#x27;,NOW());</span><br><span class="line">INSERT INTO staffs(NAME,age,pos,add_time) VALUES(&#x27;2000&#x27;,23,&#x27;dev&#x27;,NOW());</span><br><span class="line"></span><br><span class="line">SELECT * from staffs;</span><br><span class="line"></span><br><span class="line">ALTER TABLE staffs add INDEX idx_nameAgePos(name,age,pos);</span><br></pre></td></tr></table></figure>



<h5 id="explain分析"><a href="#explain分析" class="headerlink" title="explain分析"></a>explain分析</h5><p>【1】顺序列</p>
<p><code>name</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain SELECT * from staffs where NAME = &#x27;july&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563240271179.png" alt="1563240271179"></p>
<p>可以用到索引</p>
<p><code>name-&gt;age</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain SELECT * from staffs where NAME = &#x27;july&#x27; AND age = 23;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563240319660.png" alt="1563240319660"></p>
<p>也用到了索引</p>
<p><code>x-&gt;age-&gt;pos</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain SELECT * from staffs where age = 23 AND pos = &#x27;dev&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563240366826.png" alt="1563240366826"></p>
<p>没有用到索引</p>
<p><code>x-&gt;x-&gt;pos</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain SELECT * from staffs where pos = &#x27;dev&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563240405842.png" alt="1563240405842"></p>
<p>也没有用到索引</p>
<p>【2】跳过中间列</p>
<p><code>name-&gt;age</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">explain </span><br><span class="line">SELECT *</span><br><span class="line">from staffs</span><br><span class="line">where NAME = &#x27;july&#x27; AND age = 23;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563241015553.png" alt="1563241015553"></p>
<p><code>name-&gt;x-&gt;pos</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">explain </span><br><span class="line">SELECT *</span><br><span class="line">from staffs</span><br><span class="line">where NAME = &#x27;july&#x27; AND pos = &#x27;dev&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563241040433.png" alt="1563241040433"></p>
<p>发现跳过列依然用了索引，但不是全值匹配，而是部分匹配，<span style="color:red"><strong>违背了最佳左前缀法则</strong></span></p>
<hr>
<p>【结论】：</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563240461985.png" alt="1563240461985"></p>
<p>必须要从头开始，也就是name开始。建索引的第一个字段不能丢失</p>
<h4 id="案例分析——索引优化No-2"><a href="#案例分析——索引优化No-2" class="headerlink" title="案例分析——索引优化No.2"></a>案例分析——索引优化No.2</h4><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563263040242.png" alt="1563263040242"></p>
<p>如下sql语句分析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN</span><br><span class="line">select *</span><br><span class="line">from staffs</span><br><span class="line">where left(name,4) = &#x27;july&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563263085387.png" alt="1563263085387"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN</span><br><span class="line">select *</span><br><span class="line">from staffs</span><br><span class="line">where name = &#x27;july&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563263104778.png" alt="1563263104778"></p>
<hr>
<p>【结论】：使用函数会索引失效，因此不在索引上做任何操作，任何不精确的操作都会出现这个问题</p>
<h4 id="案例分析——索引优化No-3"><a href="#案例分析——索引优化No-3" class="headerlink" title="案例分析——索引优化No.3"></a>案例分析——索引优化No.3</h4><p>在有索引（name-&gt;age-&gt;pos）的前提下，查询条件出现范围后，则其右边的列就会发生索引失效</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563263710916.png" alt="1563263710916"></p>
<h4 id="案例分析——索引优化No-4"><a href="#案例分析——索引优化No-4" class="headerlink" title="案例分析——索引优化No.4"></a>案例分析——索引优化No.4</h4><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563264353622.png" alt="1563264353622"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563264607421.png" alt="1563264607421"></p>
<h4 id="案例分析——索引优化No-5"><a href="#案例分析——索引优化No-5" class="headerlink" title="案例分析——索引优化No.5"></a>案例分析——索引优化No.5</h4><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563264847779.png" alt="1563264847779"></p>
<h4 id="案例分析——索引优化No-6"><a href="#案例分析——索引优化No-6" class="headerlink" title="案例分析——索引优化No.6"></a>案例分析——索引优化No.6</h4><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563264973202.png" alt="1563264973202"></p>
<h4 id="案例分析——索引优化No-7"><a href="#案例分析——索引优化No-7" class="headerlink" title="案例分析——索引优化No.7"></a>案例分析——索引优化No.7</h4><p><span style="color:red">*<em>注意：以下是在select <em>的情况下的查询语句</em></em></span></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563265240788.png" alt="1563265240788"></p>
<hr>
<h5 id="面试问题"><a href="#面试问题" class="headerlink" title="面试问题"></a>面试问题</h5><blockquote>
<p><strong>解决like ‘%字符串%’时索引不被使用的方法？</strong></p>
<p><span style="color:red">解答：① select使用主键  ② 使用覆盖索引 </span></p>
<p><span style="color:red"><strong>查询的字段包含在建立的索引中，且查询的条件字段在索引的起始位置，比如对name进行like，则索引需建立name,email,…(最佳作前缀法则)</strong></span></p>
</blockquote>
<p>【步骤】</p>
<p>【1】建立sql准备数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE tbl_user(</span><br><span class="line">	id INT(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">	NAME VARCHAR(20) DEFAULT NULL,</span><br><span class="line">	age INT(11) DEFAULT NULL,</span><br><span class="line">	email VARCHAR(20) DEFAULT NULL,</span><br><span class="line">	PRIMARY KEY(id)</span><br><span class="line">)ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=UTF8;</span><br><span class="line"></span><br><span class="line">INSERT INTO tbl_user(NAME,age,email) VALUES(&#x27;1aa1&#x27;,21,&#x27;b@163.com&#x27;);</span><br><span class="line">INSERT INTO tbl_user(NAME,age,email) VALUES(&#x27;2aa2&#x27;,222,&#x27;a@163.com&#x27;);</span><br><span class="line">INSERT INTO tbl_user(NAME,age,email) VALUES(&#x27;3aa3&#x27;,265,&#x27;c@163.com&#x27;);</span><br><span class="line">INSERT INTO tbl_user(NAME,age,email) VALUES(&#x27;4aa4&#x27;,21,&#x27;d@163.com&#x27;);</span><br></pre></td></tr></table></figure>



<p>【2】建立索引前explain分析</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563267108055.png" alt="1563267108055"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563267139590.png" alt="1563267139590"></p>
<p>以上结果的type都是all，其他sql自行验证</p>
<p>【3】建立索引后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create index idx_user_nameAge on tbl_user(name,age);</span><br><span class="line"></span><br><span class="line"># [1] select name,age</span><br><span class="line">explain </span><br><span class="line">select name,age from tbl_user</span><br><span class="line">WHERE name like &#x27;%aa%&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563267989874.png" alt="1563267989874"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># [2] select id</span><br><span class="line">explain </span><br><span class="line">select id from tbl_user</span><br><span class="line">WHERE name like &#x27;%aa%&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563268014989.png" alt="1563268014989"></p>
<p><em><strong>由于id本身为主键，主键自带了主键索引，算是查询的索引字段的默认第一个</strong></em></p>
<p><strong>结论</strong>：以此类推,age、id,name、id,name,age、name,age一样type都是index</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563268439669.png" alt="1563268439669"></p>
<p>但是select *依然失效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">explain </span><br><span class="line">select * from tbl_user</span><br><span class="line">WHERE name like &#x27;%aa%&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563268477978.png" alt="1563268477978"></p>
<p>多了email的字段也会失效，超出了索引字段的范围</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">explain </span><br><span class="line">select id,name,age,email from tbl_user</span><br><span class="line">WHERE name like &#x27;%aa%&#x27;;</span><br></pre></td></tr></table></figure>



<h4 id="案例分析——索引优化No-8"><a href="#案例分析——索引优化No-8" class="headerlink" title="案例分析——索引优化No.8"></a>案例分析——索引优化No.8</h4><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563327288205.png" alt="1563327288205"></p>
<p>不加单引号，会引起数据类型的转换而导致全表扫描（索引失效10大原因中的第3个）</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563327358493.png" alt="1563327358493"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8D%95%E5%BC%95%E5%8F%B7.png" alt="字符串单引号"></p>
<h4 id="案例分析——索引优化No-9"><a href="#案例分析——索引优化No-9" class="headerlink" title="案例分析——索引优化No.9"></a>案例分析——索引优化No.9</h4><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563327458510.png" alt="1563327458510"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563327583485.png" alt="1563327583485"></p>
<h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563327838950.png" alt="1563327838950"></p>
<h3 id="3、面试题讲解"><a href="#3、面试题讲解" class="headerlink" title="3、面试题讲解"></a>3、面试题讲解</h3><h4 id="题目sql"><a href="#题目sql" class="headerlink" title="题目sql"></a>题目sql</h4><h5 id="1、建表SQL"><a href="#1、建表SQL" class="headerlink" title="1、建表SQL"></a>1、建表SQL</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">create table test03(</span><br><span class="line">	id INT PRIMARY KEY not null auto_increment,</span><br><span class="line">	c1 char(10),</span><br><span class="line">	c2 char(10),</span><br><span class="line">	c3 char(10),</span><br><span class="line">	c4 char(10),</span><br><span class="line">	c5 char(10)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO test03(c1,c2,c3,c4,c5) values(&#x27;a1&#x27;,&#x27;a2&#x27;,&#x27;a3&#x27;,&#x27;a4&#x27;,&#x27;a5&#x27;);</span><br><span class="line">INSERT INTO test03(c1,c2,c3,c4,c5) values(&#x27;b1&#x27;,&#x27;b2&#x27;,&#x27;b3&#x27;,&#x27;b4&#x27;,&#x27;b5&#x27;);</span><br><span class="line">INSERT INTO test03(c1,c2,c3,c4,c5) values(&#x27;c1&#x27;,&#x27;c2&#x27;,&#x27;c3&#x27;,&#x27;c4&#x27;,&#x27;c5&#x27;);</span><br><span class="line">INSERT INTO test03(c1,c2,c3,c4,c5) values(&#x27;d1&#x27;,&#x27;d2&#x27;,&#x27;d3&#x27;,&#x27;d4&#x27;,&#x27;d5&#x27;);</span><br><span class="line">INSERT INTO test03(c1,c2,c3,c4,c5) values(&#x27;e1&#x27;,&#x27;e2&#x27;,&#x27;e3&#x27;,&#x27;e4&#x27;,&#x27;e5&#x27;);</span><br></pre></td></tr></table></figure>



<h5 id="2、建索引"><a href="#2、建索引" class="headerlink" title="2、建索引"></a>2、建索引</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create index idx_c1234 on test03(c1,c2,c3,c4);</span><br><span class="line">show index from test03;</span><br></pre></td></tr></table></figure>



<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><blockquote>
<p>创建了复合索引idx_c1234，根据以下SQL分析索引使用情况</p>
</blockquote>
<h5 id="情况1-——-顺序"><a href="#情况1-——-顺序" class="headerlink" title="情况1 —— 顺序"></a>情况1 —— 顺序</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">explain select * from test03 where c1=&#x27;a1&#x27;;</span><br><span class="line">explain select * from test03 where c1=&#x27;a1&#x27; and c2=&#x27;a2&#x27;;</span><br><span class="line">explain select * from test03 where c1=&#x27;a1&#x27; and c2=&#x27;a2&#x27; and c3=&#x27;a3&#x27;;</span><br><span class="line"></span><br><span class="line"># 全值匹配</span><br><span class="line">explain select * from test03 where c1=&#x27;a1&#x27; and c2=&#x27;a2&#x27; and c3=&#x27;a3&#x27; and c4=&#x27;a4&#x27;;</span><br></pre></td></tr></table></figure>

<p>都能用到索引</p>
<h5 id="情况2-——乱序"><a href="#情况2-——乱序" class="headerlink" title="情况2 ——乱序"></a>情况2 ——乱序</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#[1]</span><br><span class="line">explain select * from test03 where c1=&#x27;a1&#x27; and c2=&#x27;a2&#x27; and c3=&#x27;a3&#x27; and c4=&#x27;a4&#x27;;</span><br><span class="line">#[2]</span><br><span class="line">explain select * from test03 where c1=&#x27;a1&#x27; and c2=&#x27;a2&#x27; and c4=&#x27;a4&#x27; and c3=&#x27;a3&#x27;;</span><br><span class="line">#[3]</span><br><span class="line">explain select * from test03 where c1=&#x27;a1&#x27; and c3=&#x27;a3&#x27; and c2=&#x27;a2&#x27; and c4=&#x27;a4&#x27;;</span><br><span class="line">#[4]</span><br><span class="line">explain select * from test03 where c2=&#x27;a2&#x27; and c1=&#x27;a1&#x27; and c3=&#x27;a3&#x27; and c4=&#x27;a4&#x27;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563330445298.png" alt="1563330445298"></p>
<p>后面两个字段颠倒  两种情况都能使用索引</p>
<p><strong>【结论】：只要带头大哥不死，后面兄弟还在，即便乱序了，mysql会自己调整顺序都会使用索引，但是尽量按照索引的顺序来，效率比较高。如果兄弟断了，那么就只用到截断前的几个字段</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from test03 where c4=&#x27;a4&#x27; and c3=&#x27;a3&#x27; and c2=&#x27;a2&#x27; and c1=&#x27;a1&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563330619617.png" alt="1563330619617"></p>
<p>顺序反过来依然能用到建立的索引，<strong>原因在于mysql本有带有优化器，会对sql语句进行分析优化</strong>，比如1+2+3和3+2+1是一样的</p>
<h5 id="情况3-——-范围"><a href="#情况3-——-范围" class="headerlink" title="情况3 —— 范围"></a>情况3 —— 范围</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from test03 where c1=&#x27;a1&#x27; and c2=&#x27;a2&#x27; and c3&gt;&#x27;a3&#x27; and c4=&#x27;a4&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563331432697.png" alt="1563331432697"></p>
<p>c1和c2用上了索引，从c3开始就是range了，c4就没法使用索引了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from test03 where c1=&#x27;a1&#x27; and c2=&#x27;a2&#x27; and c4&gt;&#x27;a4&#x27; and c3=&#x27;a3&#x27;;</span><br></pre></td></tr></table></figure>

<p>换了个顺序，c1、c2、c3、c4都是用了索引，<strong>mysql会自己调整顺序</strong>，c4被调整到了最后</p>
<h5 id="情况4-——-orderby顺序"><a href="#情况4-——-orderby顺序" class="headerlink" title="情况4 —— orderby顺序"></a>情况4 —— orderby顺序</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#[1]</span><br><span class="line">explain select * from test03 where c1=&#x27;a1&#x27; and c2=&#x27;a2&#x27; and c4&gt;&#x27;a4&#x27; </span><br><span class="line">order by c3;</span><br><span class="line">#[2]</span><br><span class="line">explain select * from test03 where c1=&#x27;a1&#x27; and c2=&#x27;a2&#x27; </span><br><span class="line">order by c3;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563332191847.png" alt="1563332191847"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563332352149.png" alt="1563332352149"></p>
<p><em><strong>【建立索引就是为了 查询 和 排序 】</strong></em></p>
<p>[1]   c1、c2使用到了索引，用于查询，c3其实也用到了索引，只不过用在了排序上。</p>
<p>[2] 结果一样，和c4无关</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain select * from test03 where c1=&#x27;a1&#x27; and c2=&#x27;a2&#x27; </span><br><span class="line">order by c4;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563332505495.png" alt="1563332505495"></p>
<p>c1、c2使用了索引，用于查询，但是中间兄弟断了，mysql无法根据我建立的索引进行排序，只能**另起炉灶对c4使用文件排序(using filesort)**，性能下降</p>
<h5 id="情况5-——-orderby乱序"><a href="#情况5-——-orderby乱序" class="headerlink" title="情况5 —— orderby乱序"></a>情况5 —— orderby乱序</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain select * from test03 where c1=&#x27;a1&#x27; and c5=&#x27;a5&#x27; </span><br><span class="line">order by c2,c3;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563333288174.png" alt="1563333288174"></p>
<p>c1使用到了索引进行查询，c2和c3也用到部分索引进行排序，<strong>没有using filesort</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain select * from test03 where c1=&#x27;a1&#x27; and c5=&#x27;a5&#x27; </span><br><span class="line">order by c3,c2;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563333462648.png" alt="1563333462648"></p>
<p>和之前对比，发现order by顺序反了，<strong>会有using filesort</strong></p>
<h5 id="情况6-——-orderby-常量乱序"><a href="#情况6-——-orderby-常量乱序" class="headerlink" title="情况6 —— orderby 常量乱序"></a>情况6 —— orderby 常量乱序</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#[1]</span><br><span class="line">explain select * from test03 where c1=&#x27;a1&#x27; and c2=&#x27;a2&#x27; </span><br><span class="line">order by c2,c3;</span><br><span class="line">#[2]</span><br><span class="line">explain select * from test03 where c1=&#x27;a1&#x27; and c2=&#x27;a2&#x27; and c5=&#x27;a5&#x27; </span><br><span class="line">order by c2,c3;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563333682639.png" alt="1563333682639"></p>
<p>结果一样 ，c1、c2两个字段的索引，但c2、c3用于排序，<strong>没有using filesort</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#[1]</span><br><span class="line">explain select * from test03 where c1=&#x27;a1&#x27; and c2=&#x27;a2&#x27; and c5=&#x27;a5&#x27; </span><br><span class="line">order by c3,c2;</span><br><span class="line"></span><br><span class="line">#[2]</span><br><span class="line">explain select * from test03 where c1=&#x27;a1&#x27; and c5=&#x27;a5&#x27; </span><br><span class="line">order by c3,c2;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563334094031.png" alt="1563334094031"></p>
<p><strong>原因：</strong></p>
<p><em><strong>一般情况下order by后面不按顺序会出现using filesort</strong></em></p>
<p>但是 [1]中c2 在where里已经是一个常量了，放在order by 后面也是一个常量，相当于<code>order by &#39;a2&#39; , c3</code> ，只用对c3进行排序即可，不会出现using filesort    ，而[2] 会出现using filesort</p>
<h5 id="情况7-——-groupby"><a href="#情况7-——-groupby" class="headerlink" title="情况7 —— groupby"></a>情况7 —— groupby</h5><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563334777364.png" alt="1563334777364"></p>
<p>group by 乱序后 性能差极了！！！！！</p>
<h4 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h4><p>where条件定值为常量（查询）、范围是排序后面失效，一般order by是给个范围</p>
<p>group by基本上都需要进行排序（<strong>分组之前必排序</strong>），会导致临时表产生</p>
<p>group by和order by几乎一致</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563352023243.png" alt="1563352023243"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563352608797.png" alt="1563352608797"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/%E6%80%BB%E7%BB%93.png" alt="总结"></p>
<h4 id="索引优化口诀"><a href="#索引优化口诀" class="headerlink" title="索引优化口诀"></a>索引优化口诀</h4><p>全值匹配我最爱，最左前缀要遵守；</p>
<p>带头大哥不能死，中间兄弟不能断；</p>
<p>索引列上少计算，范围之后全失效；</p>
<p>Like百分写最右，覆盖索引不写星；</p>
<p>不等空值还有or，索引失效要少用；</p>
<p>VAR引号不可丢，SQL高级也不难！</p>
<h1 id="3、查询截取分析"><a href="#3、查询截取分析" class="headerlink" title="3、查询截取分析"></a>3、查询截取分析</h1><blockquote>
<p>整体查询截取的分析流程如下：</p>
<p>分析</p>
<p>1、观察，至少跑1天，看看生产的慢SQL情况</p>
<p>2、开启慢查询日志，设置阈值，比如超过5秒钟的就是慢SQL，并将它抓取出来</p>
<p>3、explain + 慢SQL分析</p>
<p>4、show profile</p>
<p>5、运维经理 or DBA，进行SQL数据库服务器的参数调优</p>
<p>总结：</p>
<p>0、查询优化</p>
<p>1、慢查询的开启捕获</p>
<p>2、explain + 慢SQL分析</p>
<p>3、show profile 查询SQL在Mysql服务器里面的执行细节和生命周期情况</p>
<p>4、SQL数据库服务器的参数调优</p>
</blockquote>
<h2 id="1、查询优化"><a href="#1、查询优化" class="headerlink" title="1、查询优化"></a>1、查询优化</h2><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563435126980.png" alt="1563435126980"></p>
<h3 id="1、小表驱动大表"><a href="#1、小表驱动大表" class="headerlink" title="1、小表驱动大表"></a>1、小表驱动大表</h3><p>数据库最耗神的操作就是连接查询释放，若一百万次查询每查一次释放一次，数据库会受不了</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563435403331.png" alt="1563435403331"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563436328039.png" alt="1563436328039"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563436424779.png" alt="1563436424779"></p>
<div style="color:red">总结：<br>
1、in采用的是外表和内表笛卡尔积，exists采用的是外循环对内表查询<br>
2、子查询小的用in，子查询大的用exists</div>



<h4 id="in和exists"><a href="#in和exists" class="headerlink" title="in和exists"></a>in和exists</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#[1]</span><br><span class="line">select * from tbl_emp e </span><br><span class="line">where e.deptId </span><br><span class="line">in (select id from tbl_dept d);</span><br><span class="line"></span><br><span class="line">#[2]</span><br><span class="line">select * from tbl_emp e </span><br><span class="line">where EXISTS (select 1 from tbl_dept d where e.deptId = d.id);</span><br></pre></td></tr></table></figure>





<h3 id="2、order-by关键字优化"><a href="#2、order-by关键字优化" class="headerlink" title="2、order by关键字优化"></a>2、order by关键字优化</h3><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563588187123.png" alt="1563588187123"></p>
<h4 id="使用index方式排序"><a href="#使用index方式排序" class="headerlink" title="使用index方式排序"></a>使用index方式排序</h4><h5 id="建表SQL"><a href="#建表SQL" class="headerlink" title="建表SQL"></a>建表SQL</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">create table tblA(</span><br><span class="line">	id INT PRIMARY KEY NOT NULL AUTO_INCREMENT,</span><br><span class="line">	age INT,</span><br><span class="line">	birth TIMESTAMP NOT NULL </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">insert into tblA(age,birth) VALUES(22,NOW());</span><br><span class="line">insert into tblA(age,birth) VALUES(23,NOW());</span><br><span class="line">insert into tblA(age,birth) VALUES(24,NOW());</span><br><span class="line"></span><br><span class="line">create index idx_A_ageBirth on tblA(age,birth);</span><br><span class="line"></span><br><span class="line">select * from tblA;</span><br></pre></td></tr></table></figure>

<h5 id="案例-3"><a href="#案例-3" class="headerlink" title="案例"></a>案例</h5><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563588804573.png" alt="1563588804573"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563589038772.png" alt="1563589038772"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#[1]</span><br><span class="line">EXPLAIN</span><br><span class="line">select *</span><br><span class="line">from tbla</span><br><span class="line">ORDER BY age asc,birth asc</span><br><span class="line"></span><br><span class="line">#[2]</span><br><span class="line">EXPLAIN</span><br><span class="line">select *</span><br><span class="line">from tbla</span><br><span class="line">ORDER BY age desc,birth desc</span><br></pre></td></tr></table></figure>
<p>两个排序同方向的可以用到索引<br><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563589150556.png" alt="1563589150556"></p>
<hr>
<p>【结论】</p>
<p>1、MySQL支持两种方式的排序，FileSort和Index，Index效率高，它指MySQL扫描索引本身完成排序。FileSort方式效率较低。</p>
<p>2、order by满足两种情况，会使用Index方式排序</p>
<ul>
<li><p> [1] order by 语句使用索引最左前列</p>
</li>
<li><p>[2] 使用where子句与order by子句条件列组合满足索引最左前列</p>
</li>
</ul>
<p><span style="color:red"><strong>遵循索引键的最佳作前缀</strong></span></p>
<h4 id="firesort两种算法"><a href="#firesort两种算法" class="headerlink" title="firesort两种算法"></a>firesort两种算法</h4><p><strong>如果不在索引列上，firesort有两种算法：mysql就要启动双路排序和单路排序</strong></p>
<h5 id="双路排序"><a href="#双路排序" class="headerlink" title="双路排序"></a>双路排序</h5><p>​        MySQL4.1之前使用双路排序，字面意思就是两次扫描磁盘，最终得到数据，读取行指针和orderby列，对他们进行排序，然后扫描已经排序好的列表，按照列表中的值重新从列表中读取对应的数据输出</p>
<p>​        从磁盘取排序字段，在buffer进行排序，再从磁盘取其他字段</p>
<p>​        取一批数据，要对磁盘进行两次扫描，众所周知，I/O是很耗时的，所有在mysql4.1之后，出现了第二中改进的算法，就是单路排序</p>
<h5 id="单路排序"><a href="#单路排序" class="headerlink" title="单路排序"></a>单路排序</h5><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563589954385.png" alt="1563589954385"></p>
<h5 id="结论和引申"><a href="#结论和引申" class="headerlink" title="结论和引申"></a>结论和引申</h5><p>由于单路是后出的，总体而言好过双路，但是用单路有问题，一次数据拿不完还不如双路排序</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563590211157.png" alt="1563590211157"></p>
<h5 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h5><p>SQL数据库服务器的参数调优</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563590274583.png" alt="1563590274583"></p>
<h5 id="提高order-by的速度"><a href="#提高order-by的速度" class="headerlink" title="提高order by的速度"></a>提高order by的速度</h5><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563590318778.png" alt="1563590318778"></p>
<h4 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h4><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563591106479.png" alt="1563591106479"></p>
<h3 id="3、group-by关键字优化"><a href="#3、group-by关键字优化" class="headerlink" title="3、group by关键字优化"></a>3、group by关键字优化</h3><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563610157651.png" alt="1563610157651"></p>
<p>其他均和orderby一样</p>
<h2 id="2、慢查询日志"><a href="#2、慢查询日志" class="headerlink" title="2、慢查询日志"></a>2、慢查询日志</h2><h3 id="1、介绍-2"><a href="#1、介绍-2" class="headerlink" title="1、介绍"></a>1、介绍</h3><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563610215972.png" alt="1563610215972"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563610333217.png" alt="1563610333217"></p>
<h3 id="2、使用"><a href="#2、使用" class="headerlink" title="2、使用"></a>2、使用</h3><h4 id="1、查看是否开启了慢查询日志"><a href="#1、查看是否开启了慢查询日志" class="headerlink" title="1、查看是否开启了慢查询日志"></a>1、查看是否开启了慢查询日志</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show VARIABLES LIKE &#x27;%slow_query_log%&#x27;;</span><br></pre></td></tr></table></figure>
<p>win10如下：<br><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563610497080.png" alt="1563610497080"></p>
<p>一般情况在如下目录</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563610510076.png" alt="1563610510076"></p>
<p>linux如下：<br><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563610558929.png" alt="1563610558929"></p>
<h4 id="2、开启慢查询日志"><a href="#2、开启慢查询日志" class="headerlink" title="2、开启慢查询日志"></a>2、开启慢查询日志</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global slow_query_log = 1;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563610684640.png" alt="1563610684640"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563610777025.png" alt="1563610777025"></p>
<h4 id="3、查看设置慢查询时间"><a href="#3、查看设置慢查询时间" class="headerlink" title="3、查看设置慢查询时间"></a>3、查看设置慢查询时间</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%long_query_time%&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563610913408.png" alt="1563610913408"></p>
<h4 id="4、设置慢查询时间"><a href="#4、设置慢查询时间" class="headerlink" title="4、设置慢查询时间"></a>4、设置慢查询时间</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global long_query_time = 3;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563611079970.png" alt="1563611079970"></p>
<p>设置后满足以下两种情况才能看到变化</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563611124784.png" alt="1563611124784"></p>
<p>模拟睡眠4秒，测试日志</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select sleep(4);</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563611454033.png" alt="1563611454033"></p>
<p>linux下</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563614121741.png" alt="1563614121741"></p>
<h4 id="5、查询慢查询记录数"><a href="#5、查询慢查询记录数" class="headerlink" title="5、查询慢查询记录数"></a>5、查询慢查询记录数</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show global status like &#x27;%Slow_queries%&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563611671609.png" alt="1563611671609"></p>
<p>用来查看当前系统的健康度如何</p>
<h4 id="6、永久设置"><a href="#6、永久设置" class="headerlink" title="6、永久设置"></a>6、永久设置</h4><p>修改my.cnf</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563611883839.png" alt="1563611883839"></p>
<h3 id="3、分析"><a href="#3、分析" class="headerlink" title="3、分析"></a>3、分析</h3><p>使用MySQL的日志分析工具 <strong>mysqldumpslow</strong>，作为生产环境中分析日志，查找、分析SQL的工具</p>
<h4 id="1、介绍-3"><a href="#1、介绍-3" class="headerlink" title="1、介绍"></a>1、介绍</h4><p>linux上安装mysql后mysqldumpslow为/usr/bin的命令，可以直接使用</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563612995357.png" alt="1563612995357"></p>
<p>windows上安装mysql后使用的是mysqldumpslow.pl，但是需要安装perl环境后（安装ActivePerl），才能执行</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563613028342.png" alt="1563613028342"></p>
<p>常见参数</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563613097870.png" alt="1563613097870"></p>
<h4 id="2、使用-1"><a href="#2、使用-1" class="headerlink" title="2、使用"></a>2、使用</h4><p>常用参考</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563613249650.png" alt="1563613249650"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldumpslow -s r -t 10 localhost-slow.log</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563614233668.png" alt="1563614233668"></p>
<p><strong>建议: 为方便 可以结合 | 和 more 使用，否则可能出现爆屏</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldumpslow -s r -t 10 /var/lib/mysql/localhost-slow.log | more</span><br></pre></td></tr></table></figure>





<h2 id="3、批量数据脚本"><a href="#3、批量数据脚本" class="headerlink" title="3、批量数据脚本"></a>3、批量数据脚本</h2><blockquote>
<p>往表里插入1000W数据</p>
</blockquote>
<h3 id="1、建立SQL"><a href="#1、建立SQL" class="headerlink" title="1、建立SQL"></a>1、建立SQL</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#[1] 建立表dept</span><br><span class="line">create table dept(</span><br><span class="line">	id  int PRIMARY KEY AUTO_INCREMENT ,</span><br><span class="line">	deptno MEDIUMINT UNSIGNED NOT NULL DEFAULT 0,</span><br><span class="line">	dname VARCHAR(20) NOT NULL DEFAULT &quot;&quot;,</span><br><span class="line">	loc VARCHAR(13) NOT NULL DEFAULT &quot;&quot;</span><br><span class="line">)</span><br><span class="line">ENGINE=InnoDB</span><br><span class="line">DEFAULT CHARSET=GBK;</span><br><span class="line"></span><br><span class="line"># [2] 建立表emp</span><br><span class="line">create table emp(</span><br><span class="line">	id  int PRIMARY KEY AUTO_INCREMENT ,</span><br><span class="line">	empno MEDIUMINT UNSIGNED NOT NULL DEFAULT 0 COMMENT &#x27;编号&#x27;,</span><br><span class="line">	ename VARCHAR(20) NOT NULL DEFAULT &quot;&quot; COMMENT &#x27;名字&#x27;,</span><br><span class="line">	job VARCHAR(9) NOT NULL DEFAULT &quot;&quot; COMMENT &#x27;工作&#x27;,</span><br><span class="line">	mgr MEDIUMINT UNSIGNED NOT NULL DEFAULT 0 COMMENT &#x27;上级编号&#x27;,</span><br><span class="line">	hiredate DATE NOT NULL COMMENT &#x27;入职时间&#x27;,</span><br><span class="line">	sal DECIMAL(7,2) NOT NULL COMMENT &#x27;薪水&#x27;,</span><br><span class="line">	comm DECIMAL(7,2) NOT NULL COMMENT &#x27;红利&#x27;,</span><br><span class="line">	deptno MEDIUMINT UNSIGNED NOT NULL DEFAULT 0 COMMENT &#x27;部门编号&#x27;</span><br><span class="line">)</span><br><span class="line">ENGINE=InnoDB</span><br><span class="line">DEFAULT CHARSET=GBK;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2、设置参数"><a href="#2、设置参数" class="headerlink" title="2、设置参数"></a>2、设置参数</h3><blockquote>
<p>log_bin_trust_function_creators</p>
</blockquote>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563615598373.png" alt="1563615598373"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># [3] 设置参数</span><br><span class="line"># 由于开启慢查询日志，因为我们开启了bin-log，就必须为我们的function指定一个参数</span><br><span class="line">show VARIABLES LIKE &#x27;log_bin_trust_function_creators&#x27;;</span><br><span class="line"></span><br><span class="line">set global log_bin_trust_function_creators = 1;</span><br></pre></td></tr></table></figure>



<h3 id="3、创建函数"><a href="#3、创建函数" class="headerlink" title="3、创建函数"></a>3、创建函数</h3><p>保证每条数据都不同，随机产生字符串，随机产生部门编号</p>
<h4 id="随机产生字符串"><a href="#随机产生字符串" class="headerlink" title="随机产生字符串"></a>随机产生字符串</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 创建函数</span><br><span class="line"># 改变了mysql由原来用;结束语句改成了$$,因为函数中有多个;在一起</span><br><span class="line">DELIMITER $$</span><br><span class="line">CREATE FUNCTION rand_string(n INT) RETURNS VARCHAR(255)</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE char_str VARCHAR(100) DEFAULT &#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLNOPQRSTUVWXYZ&#x27;;</span><br><span class="line">	DECLARE return_str VARCHAR(255) DEFAULT &#x27;&#x27;;</span><br><span class="line">	DECLARE i INT DEFAULT 0;</span><br><span class="line">	WHILE i &lt; n </span><br><span class="line">	DO</span><br><span class="line">		SET return_str = CONCAT(return_str,SUBSTRING(char_str,FLOOR(1+RAND()*52),1));</span><br><span class="line">		SET i = i + 1;</span><br><span class="line">	END WHILE;</span><br><span class="line">	RETURN return_str;</span><br><span class="line">END $$</span><br></pre></td></tr></table></figure>

<h4 id="随机产生部门编号"><a href="#随机产生部门编号" class="headerlink" title="随机产生部门编号"></a>随机产生部门编号</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line">CREATE FUNCTION rand_num() RETURNS INT(5)</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE i INT DEFAULT 0;</span><br><span class="line">	SET i = FLOOR(10+RAND()*10);</span><br><span class="line">	RETURN i;</span><br><span class="line">END $$</span><br><span class="line">#删除函数</span><br><span class="line">drop FUNCTION rand_num;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4、创建存储过程"><a href="#4、创建存储过程" class="headerlink" title="4、创建存储过程"></a>4、创建存储过程</h3><h4 id="emp表插入数据"><a href="#emp表插入数据" class="headerlink" title="emp表插入数据"></a>emp表插入数据</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line">CREATE PROCEDURE insert_emp(in start INT(10),in max_num INT(10))</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE i INT DEFAULT 0;</span><br><span class="line">	SET autocommit = 0;</span><br><span class="line">	REPEAT</span><br><span class="line">		SET i = i+1;</span><br><span class="line">		INSERT INTO emp(empno,     ename,        job,      mgr,  hiredate, sal, comm,  deptno)</span><br><span class="line">		VALUES         (start+i,rand_string(6),&#x27;SALESMAN&#x27;,0001,CURDATE(),  2000, 400,   rand_num());</span><br><span class="line">		UNTIL i = max_num</span><br><span class="line">	END REPEAT;</span><br><span class="line">	COMMIT;</span><br><span class="line">END $$</span><br></pre></td></tr></table></figure>



<h4 id="dept表插入数据"><a href="#dept表插入数据" class="headerlink" title="dept表插入数据"></a>dept表插入数据</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line">CREATE PROCEDURE insert_dept(in start INT(10),in max_num INT(10))</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE i INT DEFAULT 0;</span><br><span class="line">	SET autocommit = 0;</span><br><span class="line">	REPEAT</span><br><span class="line">		SET i = i+1;</span><br><span class="line">		INSERT INTO emp(deptno,     dname,        loc)</span><br><span class="line">		VALUES         (start+i,rand_string(10),rand_string(8));</span><br><span class="line">		UNTIL i = max_num</span><br><span class="line">	END REPEAT;</span><br><span class="line">	COMMIT;</span><br><span class="line">END $$</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="5、调用存储过程"><a href="#5、调用存储过程" class="headerlink" title="5、调用存储过程"></a>5、调用存储过程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER ;</span><br><span class="line">call insert_dept(100,10);</span><br><span class="line"></span><br><span class="line">call insert_emp(100001,500000);</span><br><span class="line">call insert_emp(160001,500000);</span><br><span class="line">call insert_emp(1100001,500000);</span><br><span class="line">call insert_emp(1600001,500000);</span><br><span class="line">call insert_emp(2100001,500000);</span><br></pre></td></tr></table></figure>

<p>50W数据时间比较长，2分多钟</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563693337031.png" alt="1563693337031"></p>
<h2 id="4、show-profile（★★★）"><a href="#4、show-profile（★★★）" class="headerlink" title="4、show profile（★★★）"></a>4、show profile（★★★）</h2><h3 id="1、介绍-4"><a href="#1、介绍-4" class="headerlink" title="1、介绍"></a>1、介绍</h3><p>是mysql提供可以用来分析当前会话中语句执行的资源消耗情况，可以用于sql的调优的测量，分析SQL性能</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563694967549.png" alt="1563694967549"></p>
<h3 id="2、分析步骤"><a href="#2、分析步骤" class="headerlink" title="2、分析步骤"></a>2、分析步骤</h3><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563695234485.png" alt="1563695234485"></p>
<h4 id="1、查看当前mysql版本是否支持"><a href="#1、查看当前mysql版本是否支持" class="headerlink" title="1、查看当前mysql版本是否支持"></a>1、查看当前mysql版本是否支持</h4><p>Show profiles是5.0.37之后添加的，要想使用此功能，要确保版本在5.0.37之后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查看数据库版本</span><br><span class="line">select version();</span><br><span class="line"></span><br><span class="line"># 默认关闭的</span><br><span class="line">show VARIABLES like &#x27;profiling&#x27;;</span><br><span class="line"># show VARIABLES like &#x27;profiling%&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563695307056.png" alt="1563695307056"></p>
<h4 id="2、开启功能"><a href="#2、开启功能" class="headerlink" title="2、开启功能"></a>2、开启功能</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set profiling = on;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563695378420.png" alt="1563695378420"></p>
<h4 id="3、运行SQL"><a href="#3、运行SQL" class="headerlink" title="3、运行SQL"></a>3、运行SQL</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#修改下sql_mode ，否则不能用[1] 和[2] ,这里只是打个比方，group by不能这样用</span><br><span class="line">show variables like &quot;sql_mode&quot;;</span><br><span class="line">set sql_mode=&#x27;&#x27;;</span><br><span class="line">set sql_mode=&#x27;NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES&#x27;;</span><br><span class="line">#set sql_mode=&#x27;ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#x27;;</span><br><span class="line"></span><br><span class="line">#[1]</span><br><span class="line">select * from emp group by id%10 limit 150000;</span><br><span class="line">#[2]</span><br><span class="line">select * from emp group by id%10  order by 5;</span><br></pre></td></tr></table></figure>





<h4 id="4、诊断SQL"><a href="#4、诊断SQL" class="headerlink" title="4、诊断SQL"></a>4、诊断SQL</h4><p>执行的sql语句会被记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show profiles;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563701659351.png" alt="1563701659351"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#同时查看不同资源开销   根据query_id来查看sql的生命周期</span><br><span class="line">show profile cpu,block io for query 7;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563701738671.png" alt="1563701738671"></p>
<p>常见的参数如下：</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563702101846.png" alt="1563702101846"></p>
<p>常见的状态</p>
<table>
<thead>
<tr>
<th><strong>Status</strong></th>
<th><strong>建议</strong></th>
</tr>
</thead>
<tbody><tr>
<td>System lock</td>
<td>确认是由于哪个锁引起的，通常是因为MySQL或InnoDB内核级的锁引起的建议：如果耗时较大再关注即可，一般情况下都还好</td>
</tr>
<tr>
<td>Sending data</td>
<td>从server端发送数据到客户端，也有可能是接收存储引擎层返回的数据，再发送给客户端，数据量很大时尤其经常能看见备注：Sending Data不是网络发送，是从硬盘读取，发送到网络是Writing to net建议：通过索引或加上LIMIT，减少需要扫描并且发送给客户端的数据量</td>
</tr>
<tr>
<td>Sorting result</td>
<td>正在对结果进行排序，类似Creating sort index，不过是正常表，而不是在内存表中进行排序建议：创建适当的索引</td>
</tr>
<tr>
<td>Table lock</td>
<td>表级锁，没什么好说的，要么是因为MyISAM引擎表级锁，要么是其他情况显式锁表</td>
</tr>
<tr>
<td>create sort index</td>
<td>当前的SELECT中需要用到临时表在进行ORDER BY排序建议：创建适当的索引</td>
</tr>
<tr>
<td>checking query cache for querychecking privileges on cachedsending cached result to clienstoring result in query cache</td>
<td>和query cache相关的状态，已经多次强烈建议关闭</td>
</tr>
</tbody></table>
<h4 id="5、日常开发需要注意的结论"><a href="#5、日常开发需要注意的结论" class="headerlink" title="5、日常开发需要注意的结论"></a>5、日常开发需要注意的结论</h4><p>避免以下几种情况，需要优化SQL语句</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563702184744.png" alt="1563702184744"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563710332244.png" alt="1563710332244"></p>
<h2 id="5、全局查询日志"><a href="#5、全局查询日志" class="headerlink" title="5、全局查询日志"></a>5、全局查询日志</h2><blockquote>
<p>永远不要在生产环境开启这个功能</p>
</blockquote>
<h3 id="两种方式"><a href="#两种方式" class="headerlink" title="两种方式"></a>两种方式</h3><p>方式一：配置文件启用</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563719697578.png" alt="1563719697578"></p>
<p>方式二：</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563719720626.png" alt="1563719720626"></p>
<p>可以查看某个时间段的sql语句，时间段故障分析</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563719852329.png" alt="1563719852329"></p>
<h1 id="4、MySQL锁机制"><a href="#4、MySQL锁机制" class="headerlink" title="4、MySQL锁机制"></a>4、MySQL锁机制</h1><h2 id="1、介绍-5"><a href="#1、介绍-5" class="headerlink" title="1、介绍"></a>1、介绍</h2><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563760231545.png" alt="1563760231545"></p>
<h3 id="锁的分类"><a href="#锁的分类" class="headerlink" title="锁的分类"></a>锁的分类</h3><p>1、对数据操作的类型分</p>
<p>[1] 读锁（共享锁）：针对同一份数据，多个读操作可以同时进行而不会互相影响</p>
<p>[2] 写锁（排他锁）：当前写操作没有完成前，它会阻断其他写锁和读锁</p>
<p>2、对数据操作的粒度来分</p>
<p>[1] 表锁</p>
<p>[2] 行锁</p>
<h2 id="2、三锁"><a href="#2、三锁" class="headerlink" title="2、三锁"></a>2、三锁</h2><p>从开销、加锁速度、死锁、粒度、并发性能，根据具体应用的特点来说哪种锁更合适</p>
<h3 id="1、表锁（偏读）"><a href="#1、表锁（偏读）" class="headerlink" title="1、表锁（偏读）"></a>1、表锁（偏读）</h3><h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><blockquote>
<p>偏向MyISAM存储引擎，开销小，加锁快；无死锁；锁定粒度大，发生锁冲突的概率高，并发度最低</p>
</blockquote>
<h4 id="案例分析"><a href="#案例分析" class="headerlink" title="案例分析"></a>案例分析</h4><h5 id="建表SQL-1"><a href="#建表SQL-1" class="headerlink" title="建表SQL"></a>建表SQL</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">create table mylock(</span><br><span class="line">	id int not null PRIMARY KEY auto_increment,</span><br><span class="line">	name VARCHAR(20)</span><br><span class="line">)ENGINE myisam;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">insert into mylock(name) VALUES(&#x27;a&#x27;);</span><br><span class="line">insert into mylock(name) VALUES(&#x27;b&#x27;);</span><br><span class="line">insert into mylock(name) VALUES(&#x27;c&#x27;);</span><br><span class="line">insert into mylock(name) VALUES(&#x27;d&#x27;);</span><br><span class="line">insert into mylock(name) VALUES(&#x27;e&#x27;);</span><br><span class="line">insert into mylock(name) VALUES(&#x27;f&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SELECT * from mylock;</span><br></pre></td></tr></table></figure>





<h5 id="加读锁"><a href="#加读锁" class="headerlink" title="加读锁"></a>加读锁</h5><p>开启两个session，分别为session1、session2</p>
<p><strong>session1对mylock表加锁时</strong></p>
<p>【1】分别读取mylock和book表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># -----------       [ session1 ]     ---------------------</span><br><span class="line"># -----------[ session1对mylock表加读锁时 ]---------------</span><br><span class="line">lock table mylock read;</span><br><span class="line"></span><br><span class="line">select * from mylock;</span><br><span class="line"># session1 不能读其他表，必须释放前面的锁</span><br><span class="line">select * from book;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ------------------[ session2 ]------------------</span><br><span class="line"># ------------session1对mylock表加读锁时--------------</span><br><span class="line"># 可以读所有的表</span><br><span class="line">select * from mylock;</span><br><span class="line">select * from book;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563762886163.png" alt="1563762886163"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563762962117.png" alt="1563762962117"></p>
<p>【2】分别修改mylock表时</p>
<p>session1不能修改mylock表，session2修改表时出现阻塞情况，必须等session1结束后session2才能修改成功</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/%E8%AF%BB%E9%94%81%E9%98%BB%E5%A1%9E.gif" alt="读锁阻塞"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/%E8%AF%BB%E9%94%81.png" alt="读锁"></p>
<h5 id="加写锁"><a href="#加写锁" class="headerlink" title="加写锁"></a>加写锁</h5><p><strong>session1对mylock表加锁时</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#-------------[session1]--------------</span><br><span class="line">#--------------加写锁时------------------</span><br><span class="line">lock table mylock write;</span><br><span class="line"></span><br><span class="line"># 可读</span><br><span class="line">select * from mylock;</span><br><span class="line">#可更改</span><br><span class="line">update mylock set name = &#x27;a4&#x27; where id = 1;</span><br><span class="line"></span><br><span class="line"># 不能读其他表之前的未释放</span><br><span class="line">select * from book;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#-------------[session2]----------------</span><br><span class="line">#读其他未上锁的表正常</span><br><span class="line">select * from book;</span><br><span class="line"></span><br><span class="line">#阻塞 session1独占查询修改，session2查询都不行，修改也是一样</span><br><span class="line">select * from mylock;</span><br></pre></td></tr></table></figure>



<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/%E5%86%99%E9%94%81.png" alt="写锁"></p>
<h5 id="案例结论"><a href="#案例结论" class="headerlink" title="案例结论"></a>案例结论</h5><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/%E8%AF%BB%E5%86%99%E9%94%81%E7%BB%93%E8%AE%BA.png" alt="读写锁结论"></p>
<p><span style="color:red"><strong>简而言之，就是读锁会阻塞写，但是不会阻塞读。写锁会把读和写都阻塞。</strong></span></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/%E8%AF%BB%E5%86%99%E9%94%81%E7%BB%93%E8%AE%BA2.png" alt="读写锁结论2"></p>
<h3 id="2、行锁（偏写）"><a href="#2、行锁（偏写）" class="headerlink" title="2、行锁（偏写）"></a>2、行锁（偏写）</h3><h4 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h4><blockquote>
<p>偏向InnoDB存储引擎，开销大，加锁慢；会出现死锁，锁定粒度小，发生锁冲突的概率最低，并发度也最高</p>
<p><span style="color:red"><strong>InnDB与MyISAM的最大不同两点：一是支持事务；而是采用行级锁</strong></span></p>
</blockquote>
<h4 id="复习"><a href="#复习" class="headerlink" title="复习"></a>复习</h4><h5 id="事务、ACID属性"><a href="#事务、ACID属性" class="headerlink" title="事务、ACID属性"></a>事务、ACID属性</h5><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563849196042.png" alt="1563849196042"></p>
<h5 id="并发事务问题"><a href="#并发事务问题" class="headerlink" title="并发事务问题"></a>并发事务问题</h5><p>并发事务处理带来的问题</p>
<h6 id="更新丢失"><a href="#更新丢失" class="headerlink" title="更新丢失"></a>更新丢失</h6><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563849282872.png" alt="1563849282872"></p>
<h6 id="脏读"><a href="#脏读" class="headerlink" title="脏读"></a>脏读</h6><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563849298280.png" alt="1563849298280"></p>
<h6 id="不可重复度"><a href="#不可重复度" class="headerlink" title="不可重复度"></a>不可重复度</h6><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563849324263.png" alt="1563849324263"></p>
<h6 id="幻读"><a href="#幻读" class="headerlink" title="幻读"></a>幻读</h6><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563849369136.png" alt="1563849369136"></p>
<p><span style="color:red"><strong>总结：****脏读是事务A读取到事务B里面修改了数据，幻读是事务A读取到事务B里面新增了数据</strong></span></p>
<h5 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h5><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563849571041.png" alt="1563849571041"></p>
<h4 id="案例分析-1"><a href="#案例分析-1" class="headerlink" title="案例分析"></a>案例分析</h4><h5 id="建立SQL-3"><a href="#建立SQL-3" class="headerlink" title="建立SQL"></a>建立SQL</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">create table test_innodb_lock(</span><br><span class="line">	a int(11),</span><br><span class="line">	b varchar(16)</span><br><span class="line">)ENGINE=INNODB;</span><br><span class="line"></span><br><span class="line">insert into test_innodb_lock VALUES(1,&#x27;b2&#x27;);</span><br><span class="line">insert into test_innodb_lock VALUES(2,&#x27;3&#x27;);</span><br><span class="line">insert into test_innodb_lock VALUES(3,&#x27;3000&#x27;);</span><br><span class="line">insert into test_innodb_lock VALUES(4,&#x27;4000&#x27;);</span><br><span class="line">insert into test_innodb_lock VALUES(5,&#x27;5000&#x27;);</span><br><span class="line">insert into test_innodb_lock VALUES(6,&#x27;6000&#x27;);</span><br><span class="line">insert into test_innodb_lock VALUES(7,&#x27;7000&#x27;);</span><br><span class="line">insert into test_innodb_lock VALUES(8,&#x27;8000&#x27;);</span><br><span class="line">insert into test_innodb_lock VALUES(9,&#x27;9000&#x27;);</span><br><span class="line">insert into test_innodb_lock VALUES(1,&#x27;b1&#x27;);</span><br><span class="line"></span><br><span class="line">create INDEX test_innodb_a_ind on test_innodb_lock(a);</span><br><span class="line"></span><br><span class="line">create INDEX test_innodb_b_ind on test_innodb_lock(b);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">select * from test_innodb_lock;</span><br></pre></td></tr></table></figure>

<h5 id="行锁基本演示"><a href="#行锁基本演示" class="headerlink" title="行锁基本演示"></a>行锁基本演示</h5><p>【1】首先查看了当前的隔离级别</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;tx_isolation&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563864436638.png" alt="1563864436638"></p>
<p>【2】修改同一行</p>
<p>开启两个session会话</p>
<p>两个会话同时设置<code>set autocommit = 0;</code>把自动提交关了</p>
<p>修改某行内容，两个会话同时查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#--------------[session1]-------------</span><br><span class="line">#--------------[1] 修改某行内容</span><br><span class="line">update test_innodb_lock set b = &#x27;4005&#x27; WHERE a = 4;</span><br><span class="line">select * from test_innodb_lock;</span><br><span class="line"></span><br><span class="line">#--------------[session2]-------------</span><br><span class="line">select * from test_innodb_lock;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563864779345.png" alt="1563864779345"></p>
<p>保证了隔离级别达到的不出现<strong>脏读</strong>的情况，且在session1进行commit而session2没有commit的情况下，session2依然不会读取到修改后的值，保证了不会出现<strong>不可重复读</strong></p>
<p>两个会话都<code>commit;</code>内容一致</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563864862384.png" alt="1563864862384"></p>
<p>当session1在修改而没有commit时，session2进行修改同一行，会出现阻塞的情况，直到session1提交才能修改成功</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563865115947.png" alt="1563865115947"></p>
<p>【3】修改不同行</p>
<p>不会发生冲突，<strong>大路朝天各走一边</strong></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563865130783.png" alt="1563865130783"></p>
<h5 id="索引失效行锁变表锁"><a href="#索引失效行锁变表锁" class="headerlink" title="索引失效行锁变表锁"></a>索引失效行锁变表锁</h5><p>正常情况下：<br><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563867004784.png" alt="1563867004784"></p>
<p>索引失效情况下：行锁变表锁<br><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563867120057.png" alt="1563867120057"></p>
<h5 id="间隙锁危害"><a href="#间隙锁危害" class="headerlink" title="间隙锁危害"></a>间隙锁危害</h5><p>表中1-6缺少2的情况下</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563867588304.png" alt="1563867588304"></p>
<p>两个会话都提交后<br><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563867629535.png" alt="1563867629535"></p>
<p>【结论】<br><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563867700797.png" alt="1563867700797"></p>
<h5 id="面试题-★★★"><a href="#面试题-★★★" class="headerlink" title="面试题(★★★)"></a>面试题(★★★)</h5><p>如何锁定一行</p>
<p>在sql语句后加上<code>for update</code></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563867967102.png" alt="1563867967102"></p>
<h4 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h4><h5 id="Innodb优缺点"><a href="#Innodb优缺点" class="headerlink" title="Innodb优缺点"></a>Innodb优缺点</h5><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563868323949.png" alt="1563868323949"></p>
<h5 id="如何分析行锁定"><a href="#如何分析行锁定" class="headerlink" title="如何分析行锁定"></a>如何分析行锁定</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show status like &#x27;innodb_row_lock%&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563868485083.png" alt="1563868485083"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563868650448.png" alt="1563868650448"></p>
<h5 id="优化建议"><a href="#优化建议" class="headerlink" title="优化建议"></a>优化建议</h5><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563868717901.png" alt="1563868717901"></p>
<h3 id="3、页锁"><a href="#3、页锁" class="headerlink" title="3、页锁"></a>3、页锁</h3><p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563868765523.png" alt="1563868765523"></p>
<h1 id="5、主从复制"><a href="#5、主从复制" class="headerlink" title="5、主从复制"></a>5、主从复制</h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>slave从master读取binlog来进行数据同步，主要做多处备份</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563869815730.png" alt="1563869815730"></p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><p>具体的百度搜吧，一大堆</p>
<hr>
<p>以下不用看</p>
<p>1、mysql版本一致，且互相ping通，服务正常运行</p>
<p>2、</p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563871262129.png" alt="1563871262129"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563871272513.png" alt="1563871272513"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563871295033.png" alt="1563871295033"></p>
<p><img src="http://img.mxranger.cn/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/1563871308785.png" alt="1563871308785"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">慕·歌</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2019/12/12/back/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/">http://example.com/2019/12/12/back/MySQL%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">MxRanger's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/mysql/">mysql</a></div><div class="post_share"><div class="social-share" data-image="/images/mysql%E9%AB%98%E7%BA%A7.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2019/12/23/back/java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><img class="prev-cover" src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=3382485420,3660862088&amp;fm=26&amp;gp=0.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Java设计模式</div></div></a></div><div class="next-post pull-right"><a href="/2019/12/12/back/MySQL%E5%9F%BA%E7%A1%80%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B/"><img class="next-cover" src="/images/mysql.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MySQL基础教程</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2020/03/20/back/MySQL数据库分表实现/" title="MySQL数据库分表实现"><img class="cover" src="/images/mysql%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-03-20</div><div class="title">MySQL数据库分表实现</div></div></a></div><div><a href="/2019/12/12/back/MySQL基础高级教程/" title="MySQL基础教程"><img class="cover" src="/images/mysql.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-12-12</div><div class="title">MySQL基础教程</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/images/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">慕·歌</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">55</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">27</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">27</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/GavinGrayer"><i class="fas fa-bookmark"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:mxranger@foxmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">守的云开见明月, 做时间的朋友</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1%E3%80%81mysql%E6%9E%B6%E6%9E%84%E4%BB%8B%E7%BB%8D"><span class="toc-text">1、mysql架构介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-text">1、目录结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">2、配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6"><span class="toc-text">3、数据文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%87%E7%94%A8MyISAM"><span class="toc-text">采用MyISAM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%87%E7%94%A8InnoDB"><span class="toc-text">采用InnoDB</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E9%80%BB%E8%BE%91%E6%9E%B6%E6%9E%84"><span class="toc-text">4、逻辑架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-text">5、存储引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%9F%A5%E7%9C%8B%E5%91%BD%E4%BB%A4"><span class="toc-text">1、查看命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%B8%A4%E7%A7%8D%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-text">2、两种存储引擎的对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E3%80%81%E6%B7%98%E5%AE%9D%E7%94%A8%E5%93%AA%E4%B8%AA"><span class="toc-text">3、阿里巴巴、淘宝用哪个</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2%E3%80%81%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E5%88%86%E6%9E%90"><span class="toc-text">2、索引优化分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%80%A7%E8%83%BD%E4%B8%8B%E9%99%8D"><span class="toc-text">1、性能下降</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%B8%B8%E8%A7%81%E9%80%9A%E7%94%A8%E7%9A%84join%E6%9F%A5%E8%AF%A2"><span class="toc-text">2、常见通用的join查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81sql%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-text">1、sql执行顺序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%817%E7%A7%8Djoin"><span class="toc-text">2、7种join</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%BE%E8%A7%A3"><span class="toc-text">图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99"><span class="toc-text">编写</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="toc-text">内连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A6%E8%BF%9E%E6%8E%A5"><span class="toc-text">左连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%B3%E8%BF%9E%E6%8E%A5"><span class="toc-text">右连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A6%E8%BF%9E%E6%8E%A5%E2%80%94%E2%80%94A%E7%8B%AC%E6%9C%89"><span class="toc-text">左连接——A独有</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%B3%E8%BF%9E%E6%8E%A5%E2%80%94%E2%80%94B%E7%8B%AC%E6%9C%89"><span class="toc-text">右连接——B独有</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%A8%E8%BF%9E%E6%8E%A5"><span class="toc-text">全连接</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E7%B4%A2%E5%BC%95"><span class="toc-text">3、索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%BB%8B%E7%BB%8D"><span class="toc-text">1、介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E8%A7%A3"><span class="toc-text">详解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA"><span class="toc-text">结论</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%BC%98%E7%82%B9"><span class="toc-text">2、优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E7%BC%BA%E7%82%B9"><span class="toc-text">3、缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E5%88%86%E7%B1%BB"><span class="toc-text">5、分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E5%80%BC%E7%B4%A2%E5%BC%95"><span class="toc-text">单值索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95"><span class="toc-text">唯一索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E7%B4%A2%E5%BC%95"><span class="toc-text">复合索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA"><span class="toc-text">创建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4"><span class="toc-text">删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B"><span class="toc-text">查看</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8alter%E5%91%BD%E4%BB%A4"><span class="toc-text">使用alter命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84"><span class="toc-text">6、索引结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#BTree%E7%B4%A2%E5%BC%95%EF%BC%88%E2%98%85%E2%98%85%E2%98%85%EF%BC%89"><span class="toc-text">BTree索引（★★★）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5"><span class="toc-text">7、使用情况</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E8%A6%81%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E6%83%85%E5%86%B5"><span class="toc-text">需要创建索引情况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E9%9C%80%E8%A6%81%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E6%83%85%E5%86%B5"><span class="toc-text">不需要创建索引情况</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-text">4、性能分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81MySQL-Query-Optimizer"><span class="toc-text">1、MySQL Query Optimizer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81MySQL%E5%B8%B8%E8%A7%81%E7%93%B6%E9%A2%88"><span class="toc-text">2、MySQL常见瓶颈</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81EXPLAIN%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-text">3、EXPLAIN关键字</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E4%BB%8B%E7%BB%8D-1"><span class="toc-text">1、介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E7%94%A8%E9%80%94"><span class="toc-text">2、用途</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E5%90%84%E5%AD%97%E6%AE%B5%E8%A7%A3%E9%87%8A"><span class="toc-text">3、各字段解释</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81id-%E2%98%85%E2%98%85%E2%98%85"><span class="toc-text">1、id(★★★)</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1%E3%80%81id%E7%9B%B8%E5%90%8C"><span class="toc-text">1、id相同</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2%E3%80%81id%E4%B8%8D%E5%90%8C"><span class="toc-text">2、id不同</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3%E3%80%81id%E7%9B%B8%E5%90%8C-%E4%B8%8D%E5%90%8C"><span class="toc-text">3、id相同+不同</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81select-type"><span class="toc-text">2、select_type</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%E3%80%81table"><span class="toc-text">3、table</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4%E3%80%81type-%E2%98%85%E2%98%85%E2%98%85"><span class="toc-text">4、type(★★★)</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B"><span class="toc-text">举例</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5%E3%80%81possible-keys%E3%80%81key-%E2%98%85%E2%98%85%E2%98%85"><span class="toc-text">5、possible_keys、key(★★★)</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B1"><span class="toc-text">举例1</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B2"><span class="toc-text">举例2</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6%E3%80%81key-len"><span class="toc-text">6、key_len</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7%E3%80%81ref"><span class="toc-text">7、ref</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B1-1"><span class="toc-text">举例1</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B2-1"><span class="toc-text">举例2</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8%E3%80%81rows-%E2%98%85%E2%98%85%E2%98%85"><span class="toc-text">8、rows(★★★)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9%E3%80%81extra-%E2%98%85%E2%98%85%E2%98%85"><span class="toc-text">9、extra(★★★)</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1%E3%80%81Using-filesort-%E2%98%85%E2%98%85%E2%98%85"><span class="toc-text">1、Using filesort(★★★)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2%E3%80%81Using-temporary-%E2%98%85%E2%98%85%E2%98%85"><span class="toc-text">2、Using temporary(★★★)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3%E3%80%81Using-index-%E2%98%85%E2%98%85%E2%98%85"><span class="toc-text">3、Using index(★★★)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4%E3%80%81using-where"><span class="toc-text">4、using where</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#5%E3%80%81using-join-buffer"><span class="toc-text">5、using join buffer</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#6%E3%80%81impossible-where"><span class="toc-text">6、impossible where</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#7%E3%80%81select-tables-optimized-away"><span class="toc-text">7、select tables optimized away</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#8%E3%80%81distinct"><span class="toc-text">8、distinct</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E7%83%AD%E8%BA%AB%E6%A1%88%E4%BE%8B"><span class="toc-text">4、热身案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96"><span class="toc-text">5、索引优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%B4%A2%E5%BC%95%E5%88%86%E6%9E%90"><span class="toc-text">1、索引分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%8D%95%E8%A1%A8"><span class="toc-text">1、单表</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8BSQL"><span class="toc-text">建立SQL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E4%B8%A4%E8%A1%A8"><span class="toc-text">2、两表</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8BSQL-1"><span class="toc-text">建立SQL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-1"><span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E4%B8%89%E8%A1%A8"><span class="toc-text">3、三表</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8BSQL-2"><span class="toc-text">建立SQL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-2"><span class="toc-text">案例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%EF%BC%88%E5%BA%94%E8%AF%A5%E9%81%BF%E5%85%8D%EF%BC%89"><span class="toc-text">2、索引失效（应该避免）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%8810%E7%A7%8D%E5%8E%9F%E5%9B%A0"><span class="toc-text">索引失效10种原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90%E2%80%94%E2%80%94%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96No-1"><span class="toc-text">案例分析——索引优化No.1</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8Bsql"><span class="toc-text">建立sql</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#explain%E5%88%86%E6%9E%90"><span class="toc-text">explain分析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90%E2%80%94%E2%80%94%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96No-2"><span class="toc-text">案例分析——索引优化No.2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90%E2%80%94%E2%80%94%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96No-3"><span class="toc-text">案例分析——索引优化No.3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90%E2%80%94%E2%80%94%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96No-4"><span class="toc-text">案例分析——索引优化No.4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90%E2%80%94%E2%80%94%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96No-5"><span class="toc-text">案例分析——索引优化No.5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90%E2%80%94%E2%80%94%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96No-6"><span class="toc-text">案例分析——索引优化No.6</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90%E2%80%94%E2%80%94%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96No-7"><span class="toc-text">案例分析——索引优化No.7</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98"><span class="toc-text">面试问题</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90%E2%80%94%E2%80%94%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96No-8"><span class="toc-text">案例分析——索引优化No.8</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90%E2%80%94%E2%80%94%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96No-9"><span class="toc-text">案例分析——索引优化No.9</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E9%9D%A2%E8%AF%95%E9%A2%98%E8%AE%B2%E8%A7%A3"><span class="toc-text">3、面试题讲解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AEsql"><span class="toc-text">题目sql</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81%E5%BB%BA%E8%A1%A8SQL"><span class="toc-text">1、建表SQL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-text">2、建索引</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-text">问题</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%83%85%E5%86%B51-%E2%80%94%E2%80%94-%E9%A1%BA%E5%BA%8F"><span class="toc-text">情况1 —— 顺序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%83%85%E5%86%B52-%E2%80%94%E2%80%94%E4%B9%B1%E5%BA%8F"><span class="toc-text">情况2 ——乱序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%83%85%E5%86%B53-%E2%80%94%E2%80%94-%E8%8C%83%E5%9B%B4"><span class="toc-text">情况3 —— 范围</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%83%85%E5%86%B54-%E2%80%94%E2%80%94-orderby%E9%A1%BA%E5%BA%8F"><span class="toc-text">情况4 —— orderby顺序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%83%85%E5%86%B55-%E2%80%94%E2%80%94-orderby%E4%B9%B1%E5%BA%8F"><span class="toc-text">情况5 —— orderby乱序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%83%85%E5%86%B56-%E2%80%94%E2%80%94-orderby-%E5%B8%B8%E9%87%8F%E4%B9%B1%E5%BA%8F"><span class="toc-text">情况6 —— orderby 常量乱序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%83%85%E5%86%B57-%E2%80%94%E2%80%94-groupby"><span class="toc-text">情况7 —— groupby</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-text">总结</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E5%8F%A3%E8%AF%80"><span class="toc-text">索引优化口诀</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3%E3%80%81%E6%9F%A5%E8%AF%A2%E6%88%AA%E5%8F%96%E5%88%86%E6%9E%90"><span class="toc-text">3、查询截取分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="toc-text">1、查询优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%B0%8F%E8%A1%A8%E9%A9%B1%E5%8A%A8%E5%A4%A7%E8%A1%A8"><span class="toc-text">1、小表驱动大表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#in%E5%92%8Cexists"><span class="toc-text">in和exists</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81order-by%E5%85%B3%E9%94%AE%E5%AD%97%E4%BC%98%E5%8C%96"><span class="toc-text">2、order by关键字优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8index%E6%96%B9%E5%BC%8F%E6%8E%92%E5%BA%8F"><span class="toc-text">使用index方式排序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BB%BA%E8%A1%A8SQL"><span class="toc-text">建表SQL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-3"><span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#firesort%E4%B8%A4%E7%A7%8D%E7%AE%97%E6%B3%95"><span class="toc-text">firesort两种算法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%8C%E8%B7%AF%E6%8E%92%E5%BA%8F"><span class="toc-text">双路排序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8D%95%E8%B7%AF%E6%8E%92%E5%BA%8F"><span class="toc-text">单路排序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA%E5%92%8C%E5%BC%95%E7%94%B3"><span class="toc-text">结论和引申</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"><span class="toc-text">解决办法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8F%90%E9%AB%98order-by%E7%9A%84%E9%80%9F%E5%BA%A6"><span class="toc-text">提高order by的速度</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-3"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81group-by%E5%85%B3%E9%94%AE%E5%AD%97%E4%BC%98%E5%8C%96"><span class="toc-text">3、group by关键字优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-text">2、慢查询日志</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%BB%8B%E7%BB%8D-2"><span class="toc-text">1、介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%BD%BF%E7%94%A8"><span class="toc-text">2、使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E5%BC%80%E5%90%AF%E4%BA%86%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-text">1、查看是否开启了慢查询日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%BC%80%E5%90%AF%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-text">2、开启慢查询日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E6%9F%A5%E7%9C%8B%E8%AE%BE%E7%BD%AE%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%B6%E9%97%B4"><span class="toc-text">3、查看设置慢查询时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E8%AE%BE%E7%BD%AE%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%B6%E9%97%B4"><span class="toc-text">4、设置慢查询时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E6%9F%A5%E8%AF%A2%E6%85%A2%E6%9F%A5%E8%AF%A2%E8%AE%B0%E5%BD%95%E6%95%B0"><span class="toc-text">5、查询慢查询记录数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E6%B0%B8%E4%B9%85%E8%AE%BE%E7%BD%AE"><span class="toc-text">6、永久设置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%88%86%E6%9E%90"><span class="toc-text">3、分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E4%BB%8B%E7%BB%8D-3"><span class="toc-text">1、介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E4%BD%BF%E7%94%A8-1"><span class="toc-text">2、使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%89%B9%E9%87%8F%E6%95%B0%E6%8D%AE%E8%84%9A%E6%9C%AC"><span class="toc-text">3、批量数据脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%BB%BA%E7%AB%8BSQL"><span class="toc-text">1、建立SQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E8%AE%BE%E7%BD%AE%E5%8F%82%E6%95%B0"><span class="toc-text">2、设置参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%88%9B%E5%BB%BA%E5%87%BD%E6%95%B0"><span class="toc-text">3、创建函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA%E4%BA%A7%E7%94%9F%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-text">随机产生字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA%E4%BA%A7%E7%94%9F%E9%83%A8%E9%97%A8%E7%BC%96%E5%8F%B7"><span class="toc-text">随机产生部门编号</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-text">4、创建存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#emp%E8%A1%A8%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-text">emp表插入数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dept%E8%A1%A8%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-text">dept表插入数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E8%B0%83%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-text">5、调用存储过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81show-profile%EF%BC%88%E2%98%85%E2%98%85%E2%98%85%EF%BC%89"><span class="toc-text">4、show profile（★★★）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%BB%8B%E7%BB%8D-4"><span class="toc-text">1、介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%88%86%E6%9E%90%E6%AD%A5%E9%AA%A4"><span class="toc-text">2、分析步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8Dmysql%E7%89%88%E6%9C%AC%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81"><span class="toc-text">1、查看当前mysql版本是否支持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%BC%80%E5%90%AF%E5%8A%9F%E8%83%BD"><span class="toc-text">2、开启功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E8%BF%90%E8%A1%8CSQL"><span class="toc-text">3、运行SQL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E8%AF%8A%E6%96%ADSQL"><span class="toc-text">4、诊断SQL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E6%97%A5%E5%B8%B8%E5%BC%80%E5%8F%91%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E7%BB%93%E8%AE%BA"><span class="toc-text">5、日常开发需要注意的结论</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E5%85%A8%E5%B1%80%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-text">5、全局查询日志</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-text">两种方式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4%E3%80%81MySQL%E9%94%81%E6%9C%BA%E5%88%B6"><span class="toc-text">4、MySQL锁机制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E4%BB%8B%E7%BB%8D-5"><span class="toc-text">1、介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%81%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-text">锁的分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E4%B8%89%E9%94%81"><span class="toc-text">2、三锁</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E8%A1%A8%E9%94%81%EF%BC%88%E5%81%8F%E8%AF%BB%EF%BC%89"><span class="toc-text">1、表锁（偏读）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-text">特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90"><span class="toc-text">案例分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BB%BA%E8%A1%A8SQL-1"><span class="toc-text">建表SQL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8A%A0%E8%AF%BB%E9%94%81"><span class="toc-text">加读锁</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8A%A0%E5%86%99%E9%94%81"><span class="toc-text">加写锁</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E7%BB%93%E8%AE%BA"><span class="toc-text">案例结论</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E8%A1%8C%E9%94%81%EF%BC%88%E5%81%8F%E5%86%99%EF%BC%89"><span class="toc-text">2、行锁（偏写）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-1"><span class="toc-text">特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E4%B9%A0"><span class="toc-text">复习</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E3%80%81ACID%E5%B1%9E%E6%80%A7"><span class="toc-text">事务、ACID属性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98"><span class="toc-text">并发事务问题</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E4%B8%A2%E5%A4%B1"><span class="toc-text">更新丢失</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%84%8F%E8%AF%BB"><span class="toc-text">脏读</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E5%BA%A6"><span class="toc-text">不可重复度</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%B9%BB%E8%AF%BB"><span class="toc-text">幻读</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-text">事务隔离级别</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90-1"><span class="toc-text">案例分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8BSQL-3"><span class="toc-text">建立SQL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A1%8C%E9%94%81%E5%9F%BA%E6%9C%AC%E6%BC%94%E7%A4%BA"><span class="toc-text">行锁基本演示</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E8%A1%8C%E9%94%81%E5%8F%98%E8%A1%A8%E9%94%81"><span class="toc-text">索引失效行锁变表锁</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%97%B4%E9%9A%99%E9%94%81%E5%8D%B1%E5%AE%B3"><span class="toc-text">间隙锁危害</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E9%A2%98-%E2%98%85%E2%98%85%E2%98%85"><span class="toc-text">面试题(★★★)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-4"><span class="toc-text">总结</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Innodb%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-text">Innodb优缺点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%88%86%E6%9E%90%E8%A1%8C%E9%94%81%E5%AE%9A"><span class="toc-text">如何分析行锁定</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE"><span class="toc-text">优化建议</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E9%A1%B5%E9%94%81"><span class="toc-text">3、页锁</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5%E3%80%81%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-text">5、主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-text">原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4"><span class="toc-text">步骤</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/06/19/hello-world/" title="Hello World"><img src="http://img.mxranger.cn/gratisography-370H.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"/></a><div class="content"><a class="title" href="/2021/06/19/hello-world/" title="Hello World">Hello World</a><time datetime="2021-06-19T00:44:25.616Z" title="发表于 2021-06-19 08:44:25">2021-06-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/02/08/back/Vue%E8%84%9A%E6%89%8B%E6%9E%B6%E5%B5%8C%E5%85%A5SpringBoot/" title="Vue脚手架嵌入SpringBoot"><img src="/images/vue%E5%86%85%E5%B5%8Cspringboot.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue脚手架嵌入SpringBoot"/></a><div class="content"><a class="title" href="/2021/02/08/back/Vue%E8%84%9A%E6%89%8B%E6%9E%B6%E5%B5%8C%E5%85%A5SpringBoot/" title="Vue脚手架嵌入SpringBoot">Vue脚手架嵌入SpringBoot</a><time datetime="2021-02-08T08:35:54.000Z" title="发表于 2021-02-08 16:35:54">2021-02-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/01/31/front/vue/5%E3%80%81%E7%BB%84%E4%BB%B6%E5%8F%8A%E7%BB%84%E4%BB%B6%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1/" title="Vue——组件及组件间的通信"><img src="https://pic1.zhimg.com/v2-a3a350493a1ad6d46a1800ee2aad3fcf_1440w.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue——组件及组件间的通信"/></a><div class="content"><a class="title" href="/2021/01/31/front/vue/5%E3%80%81%E7%BB%84%E4%BB%B6%E5%8F%8A%E7%BB%84%E4%BB%B6%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1/" title="Vue——组件及组件间的通信">Vue——组件及组件间的通信</a><time datetime="2021-01-31T12:27:02.000Z" title="发表于 2021-01-31 20:27:02">2021-01-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/01/31/front/vue/6%E3%80%81%E6%A8%A1%E5%9D%97%E5%8C%96%E5%BC%80%E5%8F%91%E4%B8%8EElmentUI%E7%9A%84%E4%BD%BF%E7%94%A8/" title="Vue——模块化开发与ElmentUI的使用"><img src="https://pic1.zhimg.com/v2-a3a350493a1ad6d46a1800ee2aad3fcf_1440w.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue——模块化开发与ElmentUI的使用"/></a><div class="content"><a class="title" href="/2021/01/31/front/vue/6%E3%80%81%E6%A8%A1%E5%9D%97%E5%8C%96%E5%BC%80%E5%8F%91%E4%B8%8EElmentUI%E7%9A%84%E4%BD%BF%E7%94%A8/" title="Vue——模块化开发与ElmentUI的使用">Vue——模块化开发与ElmentUI的使用</a><time datetime="2021-01-31T12:27:02.000Z" title="发表于 2021-01-31 20:27:02">2021-01-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/01/31/front/vue/1%E3%80%81Vue%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95/" title="Vue——起步"><img src="https://pic1.zhimg.com/v2-a3a350493a1ad6d46a1800ee2aad3fcf_1440w.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue——起步"/></a><div class="content"><a class="title" href="/2021/01/31/front/vue/1%E3%80%81Vue%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95/" title="Vue——起步">Vue——起步</a><time datetime="2021-01-31T12:25:02.000Z" title="发表于 2021-01-31 20:25:02">2021-01-31</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/images/mysql%E9%AB%98%E7%BA%A7.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2021 By 慕·歌</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="http://blog.mxranger.cn/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      true && mermaid.init()
    })
  }
}</script></div><div class="aplayer no-destroy" data-id="6589190051" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="true" muted></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener toc scroll 
  window.removeEventListener('scroll', window.tocScrollFn)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>